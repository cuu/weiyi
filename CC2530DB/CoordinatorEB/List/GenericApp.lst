###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.40338/W32 for 8051         23/Aug/2012  17:43:13 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\WeiYi\Source\GenericApp.c          #
#    Command line       =  -f "D:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\WeiYi\CC2530DB\..\..\..\Tools\ #
#                          CC2530DB\f8wCoord.cfg" (-DCPU32MHZ                 #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK)    #
#                          -f "D:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\WeiYi\CC2530DB\..\..\..\Tools\ #
#                          CC2530DB\f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=0    #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "D:\Texas                   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\Source\GenericApp.c" -D               #
#                          BUILD_ALL_DEVICES -D HOLD_AUTO_START -D ZTOOL_P1   #
#                          -D MT_TASK -D MT_SYS_FUNC -D MT_ZDO_FUNC -D        #
#                          LCD_SUPPORTED=DEBUG -D HAL_UART=TRUE -D xNV_INIT   #
#                          -D NV_RESTORE -D xPOWER_SAVING -lC "D:\Texas       #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\CC2530DB\CoordinatorEB\List\" -lA     #
#                          "D:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\WeiYi\CC2530DB\CoordinatorEB\List #
#                          \" --diag_suppress Pe001,Pa010 -o "D:\Texas        #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\CC2530DB\CoordinatorEB\Obj\" -e       #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I "D:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\WeiYi\CC2530DB\" -I "D:\Texas  #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\CC2530DB\..\Source\" -I "D:\Texas     #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\CC2530DB\..\..\..\ZMain\TI2530DB\"    #
#                          -I "D:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\WeiYi\CC2530DB\..\..\..\..\..\ #
#                          Components\hal\include\" -I "D:\Texas              #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\CC2530DB\..\..\..\..\..\Components\ha #
#                          l\target\CC2530EB\" -I "D:\Texas                   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\CC2530DB\..\..\..\..\..\Components\ma #
#                          c\include\" -I "D:\Texas                           #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\CC2530DB\..\..\..\..\..\Components\ma #
#                          c\high_level\" -I "D:\Texas                        #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\CC2530DB\..\..\..\..\..\Components\ma #
#                          c\low_level\srf04\" -I "D:\Texas                   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\CC2530DB\..\..\..\..\..\Components\ma #
#                          c\low_level\srf04\single_chip\" -I "D:\Texas       #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\CC2530DB\..\..\..\..\..\Components\mt #
#                          \" -I "D:\Texas Instruments\ZStack-CC2530-2.5.1a\P #
#                          rojects\zstack\Samples\WeiYi\CC2530DB\..\..\..\..\ #
#                          ..\Components\osal\include\" -I "D:\Texas          #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\CC2530DB\..\..\..\..\..\Components\se #
#                          rvices\saddr\" -I "D:\Texas                        #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\CC2530DB\..\..\..\..\..\Components\se #
#                          rvices\sdata\" -I "D:\Texas                        #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\CC2530DB\..\..\..\..\..\Components\st #
#                          ack\af\" -I "D:\Texas Instruments\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Samples\WeiYi\CC2530DB\..\..\ #
#                          ..\..\..\Components\stack\nwk\" -I "D:\Texas       #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\CC2530DB\..\..\..\..\..\Components\st #
#                          ack\sapi\" -I "D:\Texas Instruments\ZStack-CC2530- #
#                          2.5.1a\Projects\zstack\Samples\WeiYi\CC2530DB\..\. #
#                          .\..\..\..\Components\stack\sec\" -I "D:\Texas     #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\CC2530DB\..\..\..\..\..\Components\st #
#                          ack\sys\" -I "D:\Texas Instruments\ZStack-CC2530-2 #
#                          .5.1a\Projects\zstack\Samples\WeiYi\CC2530DB\..\.. #
#                          \..\..\..\Components\stack\zdo\" -I "D:\Texas      #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\WeiYi\CC2530DB\..\..\..\..\..\Components\zm #
#                          ac\" -I "D:\Texas Instruments\ZStack-CC2530-2.5.1a #
#                          \Projects\zstack\Samples\WeiYi\CC2530DB\..\..\..\. #
#                          .\..\Components\zmac\f8w\" -Ohz                    #
#                          --require_prototypes                               #
#    List file          =  D:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\WeiYi\CC2530DB\CoordinatorEB\List\ #
#                          GenericApp.lst                                     #
#    Object file        =  D:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\WeiYi\CC2530DB\CoordinatorEB\Obj\G #
#                          enericApp.r51                                      #
#                                                                             #
#                                                                             #
###############################################################################

D:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\WeiYi\Source\GenericApp.c
      1          
      2          #include <ioCC2530.h>

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc9
   \   unsigned char volatile __sfr WDCTL
   \                     WDCTL:
   \   000000                DS 1
      3          #include <stdio.h>
      4          #include <stdlib.h>
      5          #include <string.h>
      6          
      7          #include "ZComDef.h"
      8          #include "OSAL.h"
      9          #include "sapi.h"
     10          #include "OSAL_Nv.h"
     11          
     12          #include "AF.h"
     13          #include "AssocList.h"
     14          #include "AddrMgr.h"
     15          
     16          #include "ZDApp.h"
     17          #include "ZDObject.h"
     18          #include "ZDProfile.h"
     19          
     20          #include "NLMEDE.h"
     21          #include "OnBoard.h"
     22          #include "nwk_util.h"
     23          
     24          #include "GenericApp.h"
     25          #include "DebugTrace.h"
     26          
     27          #if !defined( WIN32 )
     28            #include "OnBoard.h"
     29          #endif
     30          
     31          /* HAL */
     32          #include "hal_lcd.h"
     33          #include "hal_led.h"
     34          #include "hal_key.h"
     35          #include "hal_uart.h"
     36          
     37          
     38          /* RTOS */
     39          #if defined( IAR_ARMCM3_LM )
     40          #include "RTOS_App.h"
     41          #endif  
     42          
     43          #include "protocol.h"
     44          
     45          
     46          #define SAPICB_DATA_CNF   0xE0
     47          #define SAPICB_BIND_CNF   0xE1
     48          #define SAPICB_START_CNF  0xE2
     49          
     50          
     51          extern uint8 ZDApp_RestoreNetworkState(void);
     52          extern uint8 ZDApp_ReadNetworkRestoreState(void);
     53          void init_cc2530(void); // for init cc2530 code, be careful with zstack hardware
     54          
     55          
     56          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
     57          const cId_t GenericApp_ClusterList[GENERICAPP_MAX_CLUSTERS] =
   \                     GenericApp_ClusterList:
   \   000000   0100         DW 1
     58          {
     59            GENERICAPP_CLUSTERID
     60          };
     61          

   \                                 In  segment XDATA_ROM_C, align 1
     62          const SimpleDescriptionFormat_t GenericApp_SimpleDesc =
   \                     GenericApp_SimpleDesc:
   \   000000   0A           DB 10
   \   000001   040F         DW 3844
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   01           DB 1
   \   000007   ....         DW GenericApp_ClusterList
   \   000009   01           DB 1
   \   00000A   ....         DW GenericApp_ClusterList
     63          {
     64            GENERICAPP_ENDPOINT,              //  int Endpoint;
     65            GENERICAPP_PROFID,                //  uint16 AppProfId[2];
     66            GENERICAPP_DEVICEID,              //  uint16 AppDeviceId[2];
     67            GENERICAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
     68            GENERICAPP_FLAGS,                 //  int   AppFlags:4;
     69            GENERICAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
     70            (cId_t *)GenericApp_ClusterList,  //  byte *pAppInClusterList;
     71            GENERICAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
     72            (cId_t *)GenericApp_ClusterList   //  byte *pAppInClusterList;
     73          };
     74          
     75          // This is the Endpoint/Interface description.  It is defined here, but
     76          // filled-in in GenericApp_Init().  Another way to go would be to fill
     77          // in the structure here and make it a "const" (in code space).  The
     78          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     79          endPointDesc_t GenericApp_epDesc;
   \                     GenericApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
     80          
     81          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     82          byte GenericApp_TaskID;   // Task ID for internal task/event processing
   \                     GenericApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     83                                    // This variable will be received when
     84                                    // GenericApp_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     85          devStates_t GenericApp_NwkState;
   \                     GenericApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     86          
     87          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     88          byte GenericApp_TransID;  // This is the unique message ID (counter)
   \                     GenericApp_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     89          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     90          afAddrType_t GenericApp_DstAddr;
   \                     GenericApp_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
     91          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     92          static uint16 parentShortAddr;
   \                     parentShortAddr:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
     93          
     94          extern uint8 start_flag;
     95          
     96          // Device Info Constants
     97          #define ZB_INFO_DEV_STATE                 0
     98          #define ZB_INFO_IEEE_ADDR                 1
     99          #define ZB_INFO_SHORT_ADDR                2
    100          #define ZB_INFO_PARENT_SHORT_ADDR         3
    101          #define ZB_INFO_PARENT_IEEE_ADDR          4
    102          #define ZB_INFO_CHANNEL                   5
    103          #define ZB_INFO_PAN_ID                    6
    104          #define ZB_INFO_EXT_PAN_ID                7
    105          
    106          void cb_GetDeviceInfo ( uint8 , void *);
    107          void cb_SendDataRequest ( uint16 , uint16 , uint8 ,uint8 *, uint8 , uint8 , uint8  );
    108          void CAPI_SendCback( uint8 , uint8 , uint16 );
    109          
    110          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    111          void cb_GetDeviceInfo ( uint8 param, void *pValue )
   \                     cb_GetDeviceInfo:
    112          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    113            switch(param)
   \   000006   6017         JZ      ??cb_GetDeviceInfo_0
   \   000008   14           DEC     A
   \   000009   6026         JZ      ??cb_GetDeviceInfo_1
   \   00000B   14           DEC     A
   \   00000C   602B         JZ      ??cb_GetDeviceInfo_2
   \   00000E   14           DEC     A
   \   00000F   603A         JZ      ??cb_GetDeviceInfo_3
   \   000011   14           DEC     A
   \   000012   603F         JZ      ??cb_GetDeviceInfo_4
   \   000014   14           DEC     A
   \   000015   6044         JZ      ??cb_GetDeviceInfo_5
   \   000017   14           DEC     A
   \   000018   6049         JZ      ??cb_GetDeviceInfo_6
   \   00001A   14           DEC     A
   \   00001B   604E         JZ      ??cb_GetDeviceInfo_7
   \   00001D   8066         SJMP    ??cb_GetDeviceInfo_8
    114            {
    115              case ZB_INFO_DEV_STATE:
    116                osal_memcpy(pValue, &devState, sizeof(uint8));
   \                     ??cb_GetDeviceInfo_0:
   \   00001F                ; Setup parameters for call to function osal_memcpy
   \   00001F   75....       MOV     ?V0 + 0,#devState & 0xff
   \   000022   75....       MOV     ?V0 + 1,#(devState >> 8) & 0xff
   \                     ??cb_GetDeviceInfo_9:
   \   000025   75..00       MOV     ?V0 + 2,#0x0
   \   000028   78..         MOV     R0,#?V0 + 0
   \   00002A   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00002D   7C01         MOV     R4,#0x1
   \   00002F   804A         SJMP    ??cb_GetDeviceInfo_10
    117                break;
    118              case ZB_INFO_IEEE_ADDR:
    119                osal_memcpy(pValue, &aExtendedAddress, Z_EXTADDR_LEN);
   \                     ??cb_GetDeviceInfo_1:
   \   000031                ; Setup parameters for call to function osal_memcpy
   \   000031   75....       MOV     ?V0 + 0,#aExtendedAddress & 0xff
   \   000034   75....       MOV     ?V0 + 1,#(aExtendedAddress >> 8) & 0xff
   \   000037   8038         SJMP    ??cb_GetDeviceInfo_11
    120                break;
    121              case ZB_INFO_SHORT_ADDR:
    122                osal_memcpy(pValue, &_NIB.nwkDevAddress, sizeof(uint16));
   \                     ??cb_GetDeviceInfo_2:
   \   000039                ; Setup parameters for call to function osal_memcpy
   \   000039   75....       MOV     ?V0 + 0,#(_NIB + 20) & 0xff
   \   00003C   75....       MOV     ?V0 + 1,#((_NIB + 20) >> 8) & 0xff
   \                     ??cb_GetDeviceInfo_12:
   \   00003F   75..00       MOV     ?V0 + 2,#0x0
   \   000042   78..         MOV     R0,#?V0 + 0
   \   000044   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000047   7C02         MOV     R4,#0x2
   \   000049   8030         SJMP    ??cb_GetDeviceInfo_10
    123                break;
    124              case ZB_INFO_PARENT_SHORT_ADDR:
    125                osal_memcpy(pValue, &_NIB.nwkCoordAddress, sizeof(uint16));
   \                     ??cb_GetDeviceInfo_3:
   \   00004B                ; Setup parameters for call to function osal_memcpy
   \   00004B   75....       MOV     ?V0 + 0,#(_NIB + 23) & 0xff
   \   00004E   75....       MOV     ?V0 + 1,#((_NIB + 23) >> 8) & 0xff
   \   000051   80EC         SJMP    ??cb_GetDeviceInfo_12
    126                break;
    127              case ZB_INFO_PARENT_IEEE_ADDR:
    128                osal_memcpy(pValue, &_NIB.nwkCoordExtAddress, Z_EXTADDR_LEN);
   \                     ??cb_GetDeviceInfo_4:
   \   000053                ; Setup parameters for call to function osal_memcpy
   \   000053   75....       MOV     ?V0 + 0,#(_NIB + 25) & 0xff
   \   000056   75....       MOV     ?V0 + 1,#((_NIB + 25) >> 8) & 0xff
   \   000059   8016         SJMP    ??cb_GetDeviceInfo_11
    129                break;
    130              case ZB_INFO_CHANNEL:
    131                osal_memcpy(pValue, &_NIB.nwkLogicalChannel, sizeof(uint8));
   \                     ??cb_GetDeviceInfo_5:
   \   00005B                ; Setup parameters for call to function osal_memcpy
   \   00005B   75....       MOV     ?V0 + 0,#(_NIB + 22) & 0xff
   \   00005E   75....       MOV     ?V0 + 1,#((_NIB + 22) >> 8) & 0xff
   \   000061   80C2         SJMP    ??cb_GetDeviceInfo_9
    132                break;
    133              case ZB_INFO_PAN_ID:
    134                osal_memcpy(pValue, &_NIB.nwkPanId, sizeof(uint16));
   \                     ??cb_GetDeviceInfo_6:
   \   000063                ; Setup parameters for call to function osal_memcpy
   \   000063   75....       MOV     ?V0 + 0,#(_NIB + 33) & 0xff
   \   000066   75....       MOV     ?V0 + 1,#((_NIB + 33) >> 8) & 0xff
   \   000069   80D4         SJMP    ??cb_GetDeviceInfo_12
    135                break;
    136              case ZB_INFO_EXT_PAN_ID:
    137                osal_memcpy(pValue, &_NIB.extendedPANID, Z_EXTADDR_LEN);
   \                     ??cb_GetDeviceInfo_7:
   \   00006B                ; Setup parameters for call to function osal_memcpy
   \   00006B   75....       MOV     ?V0 + 0,#(_NIB + 53) & 0xff
   \   00006E   75....       MOV     ?V0 + 1,#((_NIB + 53) >> 8) & 0xff
   \                     ??cb_GetDeviceInfo_11:
   \   000071   75..00       MOV     ?V0 + 2,#0x0
   \   000074   78..         MOV     R0,#?V0 + 0
   \   000076   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000079   7C08         MOV     R4,#0x8
   \                     ??cb_GetDeviceInfo_10:
   \   00007B   7D00         MOV     R5,#0x0
   \   00007D   12....       LCALL   ??osal_memcpy?relay
   \   000080   7403         MOV     A,#0x3
   \   000082   12....       LCALL   ?DEALLOC_XSTACK8
    138                break;
    139            }
    140          }
   \                     ??cb_GetDeviceInfo_8:
   \   000085   7F03         MOV     R7,#0x3
   \   000087   02....       LJMP    ?BANKED_LEAVE_XDATA
    141          
    142          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    143          void CAPI_SendCback( uint8 event, uint8 status, uint16 data )
   \                     CAPI_SendCback:
    144          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   8A..         MOV     ?V0 + 1,R2
   \   000009   EC           MOV     A,R4
   \   00000A   FE           MOV     R6,A
   \   00000B   ED           MOV     A,R5
   \   00000C   FF           MOV     R7,A
    145            sapi_CbackEvent_t *pMsg;
    146          
    147            pMsg = (sapi_CbackEvent_t *)osal_msg_allocate( sizeof(sapi_CbackEvent_t) );
   \   00000D                ; Setup parameters for call to function osal_msg_allocate
   \   00000D   7A04         MOV     R2,#0x4
   \   00000F   7B00         MOV     R3,#0x0
   \   000011   12....       LCALL   ??osal_msg_allocate?relay
    148            if( pMsg )
   \   000014   EA           MOV     A,R2
   \   000015   4B           ORL     A,R3
   \   000016   601E         JZ      ??CAPI_SendCback_0
    149            {
    150              pMsg->hdr.event = event;
   \   000018   8A82         MOV     DPL,R2
   \   00001A   8B83         MOV     DPH,R3
   \   00001C   E5..         MOV     A,?V0 + 0
   \   00001E   F0           MOVX    @DPTR,A
    151              pMsg->hdr.status = status;
   \   00001F   A3           INC     DPTR
   \   000020   E5..         MOV     A,?V0 + 1
   \   000022   F0           MOVX    @DPTR,A
    152              pMsg->data = data;
   \   000023   8A82         MOV     DPL,R2
   \   000025   8B83         MOV     DPH,R3
   \   000027   A3           INC     DPTR
   \   000028   A3           INC     DPTR
   \   000029   EE           MOV     A,R6
   \   00002A   F0           MOVX    @DPTR,A
   \   00002B   A3           INC     DPTR
   \   00002C   EF           MOV     A,R7
   \   00002D   F0           MOVX    @DPTR,A
    153          
    154              osal_msg_send( GenericApp_TaskID, (uint8 *)pMsg );
   \   00002E                ; Setup parameters for call to function osal_msg_send
   \   00002E   90....       MOV     DPTR,#GenericApp_TaskID
   \   000031   E0           MOVX    A,@DPTR
   \   000032   F9           MOV     R1,A
   \   000033   12....       LCALL   ??osal_msg_send?relay
    155            }
    156          
    157          }
   \                     ??CAPI_SendCback_0:
   \   000036                REQUIRE ?Subroutine0
   \   000036                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F04         MOV     R7,#0x4
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    158          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    159          void cb_SendDataRequest ( uint16 destination, uint16 commandId, uint8 len,
   \                     cb_SendDataRequest:
    160                                    uint8 *pData, uint8 handle, uint8 txOptions, uint8 radius )
    161          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 12
   \   000005   74F4         MOV     A,#-0xc
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8C..         MOV     ?V0 + 2,R4
   \   00000C   8D..         MOV     ?V0 + 3,R5
   \   00000E   89..         MOV     ?V0 + 6,R1
   \   000010   741B         MOV     A,#0x1b
   \   000012   12....       LCALL   ?XSTACK_DISP0_8
   \   000015   E0           MOVX    A,@DPTR
   \   000016   F5..         MOV     ?V0 + 4,A
   \   000018   A3           INC     DPTR
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   F5..         MOV     ?V0 + 5,A
   \   00001C   741E         MOV     A,#0x1e
   \   00001E   12....       LCALL   ?XSTACK_DISP0_8
   \   000021   E0           MOVX    A,@DPTR
   \   000022   FE           MOV     R6,A
   \   000023   741F         MOV     A,#0x1f
   \   000025   12....       LCALL   ?XSTACK_DISP0_8
   \   000028   E0           MOVX    A,@DPTR
   \   000029   FF           MOV     R7,A
    162            afStatus_t status;
    163            afAddrType_t dstAddr;
    164          
    165            txOptions |= AF_DISCV_ROUTE;
   \   00002A   EE           MOV     A,R6
   \   00002B   D2E5         SETB    0xE0 /* A   */.5
   \   00002D   FE           MOV     R6,A
    166          
    167            // Set the destination address
    168            if (destination == ZB_BINDING_ADDR)
   \   00002E   74FE         MOV     A,#-0x2
   \   000030   6A           XRL     A,R2
   \   000031   7003         JNZ     ??cb_SendDataRequest_0
   \   000033   74FF         MOV     A,#-0x1
   \   000035   6B           XRL     A,R3
   \                     ??cb_SendDataRequest_0:
   \   000036   7009         JNZ     ??cb_SendDataRequest_1
    169            {
    170              // Binding
    171              dstAddr.addrMode = afAddrNotPresent;
   \   000038   7408         MOV     A,#0x8
   \   00003A   12....       LCALL   ?XSTACK_DISP0_8
   \   00003D   E4           CLR     A
   \   00003E   F0           MOVX    @DPTR,A
   \   00003F   801D         SJMP    ??cb_SendDataRequest_2
    172            }
    173            else
    174            {
    175              // Use short address
    176              dstAddr.addr.shortAddr = destination;
   \                     ??cb_SendDataRequest_1:
   \   000041   85..82       MOV     DPL,?XSP + 0
   \   000044   85..83       MOV     DPH,?XSP + 1
   \   000047   EA           MOV     A,R2
   \   000048   F0           MOVX    @DPTR,A
   \   000049   A3           INC     DPTR
   \   00004A   EB           MOV     A,R3
   \   00004B   F0           MOVX    @DPTR,A
    177              dstAddr.addrMode = afAddr16Bit;
   \   00004C   7408         MOV     A,#0x8
   \   00004E   12....       LCALL   ?XSTACK_DISP0_8
   \   000051   7402         MOV     A,#0x2
   \   000053   F0           MOVX    @DPTR,A
    178          
    179              if ( ADDR_NOT_BCAST != NLME_IsAddressBroadcast( destination ) )
   \   000054                ; Setup parameters for call to function NLME_IsAddressBroadcast
   \   000054   12....       LCALL   ??NLME_IsAddressBroadcast?relay
   \   000057   E9           MOV     A,R1
   \   000058   6004         JZ      ??cb_SendDataRequest_2
    180              {
    181                txOptions &= ~AF_ACK_REQUEST;
   \   00005A   EE           MOV     A,R6
   \   00005B   C2E4         CLR     0xE0 /* A   */.4
   \   00005D   FE           MOV     R6,A
    182              }
    183            }
    184          
    185            dstAddr.panId = 0;                                    // Not an inter-pan message.
   \                     ??cb_SendDataRequest_2:
   \   00005E   740A         MOV     A,#0xa
   \   000060   12....       LCALL   ?XSTACK_DISP0_8
   \   000063   E4           CLR     A
   \   000064   F0           MOVX    @DPTR,A
   \   000065   A3           INC     DPTR
   \   000066   F0           MOVX    @DPTR,A
    186            dstAddr.endPoint = GENERICAPP_ENDPOINT;  // Set the endpoint.
   \   000067   7409         MOV     A,#0x9
   \   000069   12....       LCALL   ?XSTACK_DISP0_8
   \   00006C   740A         MOV     A,#0xa
   \   00006E   F0           MOVX    @DPTR,A
    187          
    188            // Send the message
    189            status = AF_DataRequest(&dstAddr, &GenericApp_epDesc, commandId, len,
    190                                    pData, &handle, txOptions, radius);
   \   00006F                ; Setup parameters for call to function AF_DataRequest
   \   00006F   EF           MOV     A,R7
   \   000070   F5..         MOV     ?V0 + 0,A
   \   000072   78..         MOV     R0,#?V0 + 0
   \   000074   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000077   741E         MOV     A,#0x1e
   \   000079   12....       LCALL   ?XSTACK_DISP0_8
   \   00007C   8582..       MOV     ?V0 + 0,DPL
   \   00007F   8583..       MOV     ?V0 + 1,DPH
   \   000082   78..         MOV     R0,#?V0 + 0
   \   000084   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000087   78..         MOV     R0,#?V0 + 4
   \   000089   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00008C   85....       MOV     ?V0 + 0,?V0 + 6
   \   00008F   75..00       MOV     ?V0 + 1,#0x0
   \   000092   78..         MOV     R0,#?V0 + 0
   \   000094   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000097   78..         MOV     R0,#?V0 + 2
   \   000099   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00009C   EE           MOV     A,R6
   \   00009D   F9           MOV     R1,A
   \   00009E   7C..         MOV     R4,#GenericApp_epDesc & 0xff
   \   0000A0   7D..         MOV     R5,#(GenericApp_epDesc >> 8) & 0xff
   \   0000A2   7409         MOV     A,#0x9
   \   0000A4   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A7   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   0000AA   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000AD   E9           MOV     A,R1
   \   0000AE   FA           MOV     R2,A
    191          
    192            if (status != afStatus_SUCCESS)
   \   0000AF   600E         JZ      ??cb_SendDataRequest_3
    193            {
    194              CAPI_SendCback( SAPICB_DATA_CNF, status, handle );
   \   0000B1                ; Setup parameters for call to function CAPI_SendCback
   \   0000B1   741D         MOV     A,#0x1d
   \   0000B3   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B6   E0           MOVX    A,@DPTR
   \   0000B7   FC           MOV     R4,A
   \   0000B8   7D00         MOV     R5,#0x0
   \   0000BA   79E0         MOV     R1,#-0x20
   \   0000BC   12....       LCALL   ??CAPI_SendCback?relay
    195            }
    196          }
   \                     ??cb_SendDataRequest_3:
   \   0000BF   740C         MOV     A,#0xc
   \   0000C1   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000C4   7F07         MOV     R7,#0x7
   \   0000C6   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   AA82         MOV     R2,DPL
   \   000002   AB83         MOV     R3,DPH
   \   000004                REQUIRE ??Subroutine11_0
   \   000004                ; // Fall through to label ??Subroutine11_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine11_0:
   \   000000   12....       LCALL   ??AF_DataRequest?relay
   \   000003   7409         MOV     A,#0x9
   \   000005   22           RET
    197          
    198          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    199          void Serial_callBack(uint8 port, uint8 event)
   \                     Serial_callBack:
    200          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 204
   \   000005   7434         MOV     A,#0x34
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    201            char theMessageData[] = "Hello";
    202            zAddrType_t dstAddr;
    203            zAddrType_t ZAddr;
    204            
    205            afAddrType_t myaddr; // use for p2p
    206            
    207            char pbuf[3];
    208            char pbuf1[3];
    209            uint16 cmd;
    210            
    211            uint8 buff[128];
    212            uint8 readBytes = 0;
    213            
    214            uint16 short_ddr;
    215            uint16 panid;
    216            uint8 *ieeeAddr;
    217            
    218            uint16 *p1;
    219            
    220            byte cnt = 0;
    221            uint8 yy1;
    222            uint8 yy2;
    223            
    224            uint8 i;
    225            byte nr;
    226            uint16 devlist[ NWK_MAX_DEVICES + 1];
    227            associated_devices_t *adp; // delete devices
    228            
    229            //short_ddr = GenericApp_DstAddr.addr.shortAddr;
    230            uint8 startOptions;    
    231            uint8 logicalType;
    232            
    233            logicalType = (uint8)ZDO_Config_Node_Descriptor.LogicalType;
    234            
    235                      
    236            readBytes = HalUARTRead(SER_PORT, buff, 127);
   \   00000A                ; Setup parameters for call to function HalUARTRead
   \   00000A   7C7F         MOV     R4,#0x7f
   \   00000C   7D00         MOV     R5,#0x0
   \   00000E   7420         MOV     A,#0x20
   \   000010   12....       LCALL   ?XSTACK_DISP0_8
   \   000013   AA82         MOV     R2,DPL
   \   000015   AB83         MOV     R3,DPH
   \   000017   7900         MOV     R1,#0x0
   \   000019   12....       LCALL   ??HalUARTRead?relay
   \   00001C   EA           MOV     A,R2
   \   00001D   F5..         MOV     ?V0 + 0,A
    237            if (readBytes > 0)
   \   00001F   7003         JNZ     $+5
   \   000021   02....       LJMP    ??Serial_callBack_0 & 0xFFFF
    238            {
    239              //HalUARTWrite( SER_PORT, "DataRead: ",10);
    240              // HalUARTWrite( SER_PORT, buff, readBytes);
    241              if(readBytes == 4)
   \   000024   7404         MOV     A,#0x4
   \   000026   65..         XRL     A,?V0 + 0
   \   000028   7042         JNZ     ??Serial_callBack_1
    242              {
    243                if(buff[0] == 'p' && buff[1] == 'i' && buff[2]=='n' && buff[3] == 'g')
   \   00002A   7420         MOV     A,#0x20
   \   00002C   12....       LCALL   ?XSTACK_DISP0_8
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   6470         XRL     A,#0x70
   \   000032   6003         JZ      $+5
   \   000034   02....       LJMP    ??Serial_callBack_2 & 0xFFFF
   \   000037   7421         MOV     A,#0x21
   \   000039   12....       LCALL   ?XSTACK_DISP0_8
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   6469         XRL     A,#0x69
   \   00003F   6003         JZ      $+5
   \   000041   02....       LJMP    ??Serial_callBack_3 & 0xFFFF
   \   000044   7422         MOV     A,#0x22
   \   000046   12....       LCALL   ?XSTACK_DISP0_8
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   646E         XRL     A,#0x6e
   \   00004C   6003         JZ      $+5
   \   00004E   02....       LJMP    ??Serial_callBack_3 & 0xFFFF
   \   000051   7423         MOV     A,#0x23
   \   000053   12....       LCALL   ?XSTACK_DISP0_8
   \   000056   E0           MOVX    A,@DPTR
   \   000057   6467         XRL     A,#0x67
   \   000059   6003         JZ      $+5
   \   00005B   02....       LJMP    ??Serial_callBack_3 & 0xFFFF
    244                {
    245                    UART_Send_String( "pong", 4 );
   \   00005E                ; Setup parameters for call to function UART_Send_String
   \   00005E   7C04         MOV     R4,#0x4
   \   000060   7D00         MOV     R5,#0x0
   \   000062   7A..         MOV     R2,#`?<Constant "pong">` & 0xff
   \   000064   7B..         MOV     R3,#(`?<Constant "pong">` >> 8) & 0xff
   \   000066   12....       LCALL   ??UART_Send_String?relay
   \   000069   02....       LJMP    ??Serial_callBack_2 & 0xFFFF
    246                }
    247              }
    248              
    249              if( readBytes == 1)
   \                     ??Serial_callBack_1:
   \   00006C   7401         MOV     A,#0x1
   \   00006E   65..         XRL     A,?V0 + 0
   \   000070   6003         JZ      $+5
   \   000072   02....       LJMP    ??Serial_callBack_4 & 0xFFFF
    250              {
    251                  yy1 = 1;
   \   000075   75..01       MOV     ?V0 + 1,#0x1
    252                  if(buff[0]== 's')
   \   000078   7420         MOV     A,#0x20
   \   00007A   12....       LCALL   ?XSTACK_DISP0_8
   \   00007D   E0           MOVX    A,@DPTR
   \   00007E   6473         XRL     A,#0x73
   \   000080   701C         JNZ     ??Serial_callBack_5
    253                  {
    254                    /// short address
    255                    short_ddr = _NIB.nwkDevAddress;
   \   000082   90....       MOV     DPTR,#_NIB + 20
   \   000085   E0           MOVX    A,@DPTR
   \   000086   F8           MOV     R0,A
   \   000087   A3           INC     DPTR
   \   000088   E0           MOVX    A,@DPTR
   \   000089   F9           MOV     R1,A
   \   00008A   7401         MOV     A,#0x1
   \   00008C   12....       LCALL   ?XSTACK_DISP0_8
   \   00008F   12....       LCALL   ?Subroutine2 & 0xFFFF
    256                    
    257                    UART_Send_String( (uint8*)&short_ddr, 2);
    258                    
    259                  }
   \                     ??CrossCallReturnLabel_2:
   \   000092   7401         MOV     A,#0x1
   \   000094   12....       LCALL   ?XSTACK_DISP0_8
   \   000097   AA82         MOV     R2,DPL
   \   000099   AB83         MOV     R3,DPH
   \   00009B   12....       LCALL   ??UART_Send_String?relay
    260                  if(buff[0] == 'p')
   \                     ??Serial_callBack_5:
   \   00009E   7420         MOV     A,#0x20
   \   0000A0   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A3   E0           MOVX    A,@DPTR
   \   0000A4   6470         XRL     A,#0x70
   \   0000A6   701C         JNZ     ??Serial_callBack_6
    261                  {
    262                    /// pan id
    263                    panid = _NIB.nwkPanId;
   \   0000A8   90....       MOV     DPTR,#_NIB + 33
   \   0000AB   E0           MOVX    A,@DPTR
   \   0000AC   F8           MOV     R0,A
   \   0000AD   A3           INC     DPTR
   \   0000AE   E0           MOVX    A,@DPTR
   \   0000AF   F9           MOV     R1,A
   \   0000B0   7403         MOV     A,#0x3
   \   0000B2   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B5   12....       LCALL   ?Subroutine2 & 0xFFFF
    264                    UART_Send_String( (uint8*)&panid, 2);          
    265                  }
   \                     ??CrossCallReturnLabel_3:
   \   0000B8   7403         MOV     A,#0x3
   \   0000BA   12....       LCALL   ?XSTACK_DISP0_8
   \   0000BD   AA82         MOV     R2,DPL
   \   0000BF   AB83         MOV     R3,DPH
   \   0000C1   12....       LCALL   ??UART_Send_String?relay
    266                  if(buff[0] == 'c')/// channel
   \                     ??Serial_callBack_6:
   \   0000C4   7420         MOV     A,#0x20
   \   0000C6   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C9   E0           MOVX    A,@DPTR
   \   0000CA   6463         XRL     A,#0x63
   \   0000CC   7016         JNZ     ??Serial_callBack_7
    267                  {
    268                      yy2 = _NIB.nwkLogicalChannel;
   \   0000CE   90....       MOV     DPTR,#_NIB + 22
   \   0000D1   E0           MOVX    A,@DPTR
   \   0000D2   85..82       MOV     DPL,?XSP + 0
   \   0000D5   85..83       MOV     DPH,?XSP + 1
   \   0000D8   F0           MOVX    @DPTR,A
    269                      UART_Send_String( (uint8*)&yy2, 1);
   \   0000D9                ; Setup parameters for call to function UART_Send_String
   \   0000D9   7C01         MOV     R4,#0x1
   \   0000DB   7D00         MOV     R5,#0x0
   \   0000DD   AA82         MOV     R2,DPL
   \   0000DF   AB83         MOV     R3,DPH
   \   0000E1   12....       LCALL   ??UART_Send_String?relay
    270                      
    271                  }
    272                  if(buff[0] =='m') // mac address
   \                     ??Serial_callBack_7:
   \   0000E4   7420         MOV     A,#0x20
   \   0000E6   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E9   E0           MOVX    A,@DPTR
   \   0000EA   646D         XRL     A,#0x6d
   \   0000EC   700A         JNZ     ??Serial_callBack_8
    273                  {
    274                      ieeeAddr = NLME_GetExtAddr();
    275                      UART_Send_String( ieeeAddr, 8);
   \   0000EE                ; Setup parameters for call to function UART_Send_String
   \   0000EE                ; Setup parameters for call to function NLME_GetExtAddr
   \   0000EE   12....       LCALL   ??NLME_GetExtAddr?relay
   \   0000F1   7C08         MOV     R4,#0x8
   \   0000F3   7D00         MOV     R5,#0x0
   \   0000F5   12....       LCALL   ??UART_Send_String?relay
    276                      
    277                  }
    278          
    279                  if( buff[0] ==0xc0) // coordinator 
   \                     ??Serial_callBack_8:
   \   0000F8   7420         MOV     A,#0x20
   \   0000FA   12....       LCALL   ?XSTACK_DISP0_8
   \   0000FD   E0           MOVX    A,@DPTR
   \   0000FE   64C0         XRL     A,#0xc0
   \   000100   7006         JNZ     ??Serial_callBack_9
    280                  {
    281          
    282                    set_coordi();       
   \   000102                ; Setup parameters for call to function set_coordi
   \   000102   12....       LCALL   ??set_coordi?relay
    283                    return;
   \   000105   02....       LJMP    ??Serial_callBack_0 & 0xFFFF
    284                  }
    285          
    286                  if( buff[0] ==0xe0) // router
   \                     ??Serial_callBack_9:
   \   000108   E0           MOVX    A,@DPTR
   \   000109   64E0         XRL     A,#0xe0
   \   00010B   7006         JNZ     ??Serial_callBack_10
    287                  {
    288                    set_router();
   \   00010D                ; Setup parameters for call to function set_router
   \   00010D   12....       LCALL   ??set_router?relay
    289                    
    290                    return;
   \   000110   02....       LJMP    ??Serial_callBack_0 & 0xFFFF
    291                  }
    292                  
    293                  if(buff[0] == 0xCA)
   \                     ??Serial_callBack_10:
   \   000113   E0           MOVX    A,@DPTR
   \   000114   64CA         XRL     A,#0xca
   \   000116   6003         JZ      $+5
   \   000118   02....       LJMP    ??Serial_callBack_11 & 0xFFFF
    294                  {
    295                    // Ê¹ÃüµÄÕÐ»½
    296                    // read self AssociatedDevList
    297                    for(i=0;i< NWK_MAX_DEVICES; i++)
   \   00011B   7C00         MOV     R4,#0x0
    298                    {
    299                       nr = AssociatedDevList[ i ].nodeRelation;
    300                       if(nr > 0 && nr < 5) //CHILD_RFD CHILD_RFD_RX_IDLE CHILD_FFD CHILD_FFD_RX_IDLE
   \                     ??Serial_callBack_12:
   \   00011D   EC           MOV     A,R4
   \   00011E   75F012       MOV     B,#0x12
   \   000121   A4           MUL     AB
   \   000122   F8           MOV     R0,A
   \   000123   A9F0         MOV     R1,B
   \   000125   74..         MOV     A,#(AssociatedDevList + 4) & 0xff
   \   000127   28           ADD     A,R0
   \   000128   F582         MOV     DPL,A
   \   00012A   74..         MOV     A,#((AssociatedDevList + 4) >> 8) & 0xff
   \   00012C   39           ADDC    A,R1
   \   00012D   F583         MOV     DPH,A
   \   00012F   E0           MOVX    A,@DPTR
   \   000130   14           DEC     A
   \   000131   C3           CLR     C
   \   000132   9404         SUBB    A,#0x4
   \   000134   502D         JNC     ??Serial_callBack_13
    301                       //if( nr != 0XFF)
    302                       {
    303                         //   myaddr.addrMode = (afAddrMode_t)Addr16Bit;
    304                         //   myaddr.endPoint = GENERICAPP_ENDPOINT;
    305                       //  if( AssociatedDevList[ i ].shortAddr != 0x0000)
    306                       //  {
    307                            //if( AssocIsChild( AssociatedDevList[ i ].shortAddr ) != 1 || AssociatedDevList[ i ].age > NWK_ROUTE_AGE_LIMIT)
    308                            //if( AssocIsChild( AssociatedDevList[ i ].shortAddr ) == 1 && AssociatedDevList[ i ].age > NWK_ROUTE_AGE_LIMIT )
    309                           // {
    310                              //  myaddr.addr.shortAddr = AssociatedDevList[ i ].shortAddr;
    311                                /*
    312                                if ( AF_DataRequest( &myaddr, &GenericApp_epDesc, GENERICAPP_CLUSTERID,(byte)osal_strlen( theMessageData ) + 1,
    313                                        (byte *)&theMessageData,
    314                                        &GenericApp_TransID,
    315                                        AF_ACK_REQUEST, AF_DEFAULT_RADIUS ) != afStatus_SUCCESS )
    316                                  {
    317                                    uprint("delete asso");
    318                                  */
    319                             //       delete_asso( AssociatedDevList[ i ]. addrIdx);
    320                                    
    321                            // }
    322                              //    else
    323                               //   {
    324                                    devlist[yy1] = AssociatedDevList[ i ].shortAddr;
   \   000136   74..         MOV     A,#AssociatedDevList & 0xff
   \   000138   28           ADD     A,R0
   \   000139   F582         MOV     DPL,A
   \   00013B   74..         MOV     A,#(AssociatedDevList >> 8) & 0xff
   \   00013D   39           ADDC    A,R1
   \   00013E   F583         MOV     DPH,A
   \   000140   E0           MOVX    A,@DPTR
   \   000141   FA           MOV     R2,A
   \   000142   A3           INC     DPTR
   \   000143   E0           MOVX    A,@DPTR
   \   000144   FB           MOV     R3,A
   \   000145   E5..         MOV     A,?V0 + 1
   \   000147   C3           CLR     C
   \   000148   33           RLC     A
   \   000149   F8           MOV     R0,A
   \   00014A   E4           CLR     A
   \   00014B   33           RLC     A
   \   00014C   F9           MOV     R1,A
   \   00014D   74A0         MOV     A,#-0x60
   \   00014F   12....       LCALL   ?XSTACK_DISP0_8
   \   000152   E582         MOV     A,DPL
   \   000154   28           ADD     A,R0
   \   000155   F582         MOV     DPL,A
   \   000157   E583         MOV     A,DPH
   \   000159   39           ADDC    A,R1
   \   00015A   F583         MOV     DPH,A
   \   00015C   EA           MOV     A,R2
   \   00015D   F0           MOVX    @DPTR,A
   \   00015E   A3           INC     DPTR
   \   00015F   EB           MOV     A,R3
   \   000160   F0           MOVX    @DPTR,A
    325                                    yy1++;
   \   000161   05..         INC     ?V0 + 1
    326                               //   }
    327                            
    328                            // }
    329                       }//else {break;}
    330                    }
   \                     ??Serial_callBack_13:
   \   000163   0C           INC     R4
   \   000164   EC           MOV     A,R4
   \   000165   C3           CLR     C
   \   000166   9415         SUBB    A,#0x15
   \   000168   40B3         JC      ??Serial_callBack_12
    331                    devlist[0] = BUILD_UINT16(0xce,  AssocCount(1, 4) );
   \   00016A                ; Setup parameters for call to function AssocCount
   \   00016A   7A04         MOV     R2,#0x4
   \   00016C   7901         MOV     R1,#0x1
   \   00016E   12....       LCALL   ??AssocCount?relay
   \   000171   EA           MOV     A,R2
   \   000172   F9           MOV     R1,A
   \   000173   74A0         MOV     A,#-0x60
   \   000175   12....       LCALL   ?XSTACK_DISP0_8
   \   000178   74CE         MOV     A,#-0x32
   \   00017A   F0           MOVX    @DPTR,A
   \   00017B   A3           INC     DPTR
   \   00017C   E9           MOV     A,R1
   \   00017D   F0           MOVX    @DPTR,A
    332                    UART_Send_String( (uint8*)&devlist[0], yy1*2);
   \   00017E                ; Setup parameters for call to function UART_Send_String
   \   00017E   E5..         MOV     A,?V0 + 1
   \   000180   C3           CLR     C
   \   000181   33           RLC     A
   \   000182   FC           MOV     R4,A
   \   000183   E4           CLR     A
   \   000184   33           RLC     A
   \   000185   FD           MOV     R5,A
   \   000186   74A0         MOV     A,#-0x60
   \   000188   12....       LCALL   ?XSTACK_DISP0_8
   \   00018B   AA82         MOV     R2,DPL
   \   00018D   AB83         MOV     R3,DPH
   \   00018F   12....       LCALL   ??UART_Send_String?relay
    333                      //p1 = AssocMakeList( &cnt );
    334                      //UART_Send_String( (uint8*)p1,  AssocCount(1, 4)*2);
    335                      //osal_mem_free(p1);
    336                    return;
   \   000192   02....       LJMP    ??Serial_callBack_0 & 0xFFFF
    337                  }
    338              }
    339              
    340          #if defined( ZDO_COORDINATOR )
    341              // only coordinator can have this function
    342              if(readBytes == 3)
   \                     ??Serial_callBack_4:
   \   000195   7403         MOV     A,#0x3
   \   000197   65..         XRL     A,?V0 + 0
   \   000199   6003         JZ      $+5
   \   00019B   02....       LJMP    ??Serial_callBack_14 & 0xFFFF
    343              {
    344                
    345                if( buff[0] == 0xCA || buff[0] == 0x6d)
   \   00019E   7420         MOV     A,#0x20
   \   0001A0   12....       LCALL   ?XSTACK_DISP0_8
   \   0001A3   E0           MOVX    A,@DPTR
   \   0001A4   64CA         XRL     A,#0xca
   \   0001A6   6008         JZ      ??Serial_callBack_15
   \   0001A8   E0           MOVX    A,@DPTR
   \   0001A9   646D         XRL     A,#0x6d
   \   0001AB   6003         JZ      $+5
   \   0001AD   02....       LJMP    ??Serial_callBack_2 & 0xFFFF
    346                {
    347                  // CA xx xx ,send CA to a node ,with it's short address
    348                  ///uprint("it's CA ");
    349                  short_ddr = BUILD_UINT16( buff[1], buff[2] );
   \                     ??Serial_callBack_15:
   \   0001B0   7421         MOV     A,#0x21
   \   0001B2   12....       LCALL   ?XSTACK_DISP0_8
   \   0001B5   E0           MOVX    A,@DPTR
   \   0001B6   FA           MOV     R2,A
   \   0001B7   7422         MOV     A,#0x22
   \   0001B9   12....       LCALL   ?XSTACK_DISP0_8
   \   0001BC   E0           MOVX    A,@DPTR
   \   0001BD   F9           MOV     R1,A
   \   0001BE   EA           MOV     A,R2
   \   0001BF   F8           MOV     R0,A
   \   0001C0   7401         MOV     A,#0x1
   \   0001C2   12....       LCALL   ?XSTACK_DISP0_8
   \   0001C5   E8           MOV     A,R0
   \   0001C6   F0           MOVX    @DPTR,A
   \   0001C7   A3           INC     DPTR
   \   0001C8   E9           MOV     A,R1
   \   0001C9   F0           MOVX    @DPTR,A
    350                  myaddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   0001CA   741C         MOV     A,#0x1c
   \   0001CC   12....       LCALL   ?XSTACK_DISP0_8
   \   0001CF   7402         MOV     A,#0x2
   \   0001D1   F0           MOVX    @DPTR,A
    351                  myaddr.endPoint = GENERICAPP_ENDPOINT;
   \   0001D2   741D         MOV     A,#0x1d
   \   0001D4   12....       LCALL   ?XSTACK_DISP0_8
   \   0001D7   740A         MOV     A,#0xa
   \   0001D9   F0           MOVX    @DPTR,A
    352                  myaddr.addr.shortAddr = short_ddr;
   \   0001DA   7401         MOV     A,#0x1
   \   0001DC   12....       LCALL   ?XSTACK_DISP0_8
   \   0001DF   E0           MOVX    A,@DPTR
   \   0001E0   F8           MOV     R0,A
   \   0001E1   A3           INC     DPTR
   \   0001E2   E0           MOVX    A,@DPTR
   \   0001E3   F9           MOV     R1,A
   \   0001E4   7414         MOV     A,#0x14
   \   0001E6   12....       LCALL   ?XSTACK_DISP0_8
   \   0001E9   E8           MOV     A,R0
   \   0001EA   F0           MOVX    @DPTR,A
   \   0001EB   A3           INC     DPTR
   \   0001EC   E9           MOV     A,R1
   \   0001ED   F0           MOVX    @DPTR,A
    353                  
    354                  if ( AF_DataRequest( &myaddr, &GenericApp_epDesc, GENERICAPP_CLUSTERID, 1,
    355                                    (byte *)&buff,
    356                                    &GenericApp_TransID,
    357                                    AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) != afStatus_SUCCESS )
   \   0001EE                ; Setup parameters for call to function AF_DataRequest
   \   0001EE   75..1E       MOV     ?V0 + 0,#0x1e
   \   0001F1   78..         MOV     R0,#?V0 + 0
   \   0001F3   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001F6   75....       MOV     ?V0 + 0,#GenericApp_TransID & 0xff
   \   0001F9   75....       MOV     ?V0 + 1,#(GenericApp_TransID >> 8) & 0xff
   \   0001FC   78..         MOV     R0,#?V0 + 0
   \   0001FE   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000201   7423         MOV     A,#0x23
   \   000203   12....       LCALL   ?XSTACK_DISP0_8
   \   000206   8582..       MOV     ?V0 + 0,DPL
   \   000209   8583..       MOV     ?V0 + 1,DPH
   \   00020C   78..         MOV     R0,#?V0 + 0
   \   00020E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000211   75..01       MOV     ?V0 + 0,#0x1
   \   000214   75..00       MOV     ?V0 + 1,#0x0
   \   000217   78..         MOV     R0,#?V0 + 0
   \   000219   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00021C   78..         MOV     R0,#?V0 + 0
   \   00021E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000221   7920         MOV     R1,#0x20
   \   000223   7C..         MOV     R4,#GenericApp_epDesc & 0xff
   \   000225   7D..         MOV     R5,#(GenericApp_epDesc >> 8) & 0xff
   \   000227   741D         MOV     A,#0x1d
   \   000229   12....       LCALL   ?XSTACK_DISP0_8
   \   00022C   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   00022F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000232   E9           MOV     A,R1
   \   000233   7003         JNZ     $+5
   \   000235   02....       LJMP    ??Serial_callBack_0 & 0xFFFF
    358                  {
    359                       AF_DataRequest( &myaddr, &GenericApp_epDesc, GENERICAPP_CLUSTERID, 1,
    360                                    (byte *)&buff,
    361                                    &GenericApp_TransID,
    362                                    AF_DISCV_ROUTE, AF_DEFAULT_RADIUS );
   \   000238                ; Setup parameters for call to function AF_DataRequest
   \   000238   75..1E       MOV     ?V0 + 0,#0x1e
   \   00023B   78..         MOV     R0,#?V0 + 0
   \   00023D   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000240   75....       MOV     ?V0 + 0,#GenericApp_TransID & 0xff
   \   000243   75....       MOV     ?V0 + 1,#(GenericApp_TransID >> 8) & 0xff
   \   000246   78..         MOV     R0,#?V0 + 0
   \   000248   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00024B   7423         MOV     A,#0x23
   \   00024D   12....       LCALL   ?XSTACK_DISP0_8
   \   000250   8582..       MOV     ?V0 + 0,DPL
   \   000253   8583..       MOV     ?V0 + 1,DPH
   \   000256   78..         MOV     R0,#?V0 + 0
   \   000258   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00025B   75..01       MOV     ?V0 + 0,#0x1
   \   00025E   75..00       MOV     ?V0 + 1,#0x0
   \   000261   78..         MOV     R0,#?V0 + 0
   \   000263   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000266   78..         MOV     R0,#?V0 + 0
   \   000268   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00026B   7920         MOV     R1,#0x20
   \   00026D   7C..         MOV     R4,#GenericApp_epDesc & 0xff
   \   00026F   7D..         MOV     R5,#(GenericApp_epDesc >> 8) & 0xff
   \   000271   741D         MOV     A,#0x1d
   \   000273   12....       LCALL   ?XSTACK_DISP0_8
   \   000276   AA82         MOV     R2,DPL
   \   000278   AB83         MOV     R3,DPH
   \   00027A   02....       LJMP    ??Serial_callBack_16 & 0xFFFF
    363                       // send twice only, if it is still not ok, fuck it
    364                    
    365                  }
    366                 return;
    367                }
    368              }
    369                    
    370          #endif 
    371                    
    372              if( readBytes >= 2)
   \                     ??Serial_callBack_14:
   \   00027D   EA           MOV     A,R2
   \   00027E   C3           CLR     C
   \   00027F   9402         SUBB    A,#0x2
   \   000281   5003         JNC     $+5
   \   000283   02....       LJMP    ??Serial_callBack_11 & 0xFFFF
    373              {
    374               
    375                if( buff[0] == 'e' && buff[1] == '#')
   \                     ??Serial_callBack_2:
   \   000286   7420         MOV     A,#0x20
   \   000288   12....       LCALL   ?XSTACK_DISP0_8
   \   00028B   E0           MOVX    A,@DPTR
   \   00028C   6465         XRL     A,#0x65
   \   00028E   707D         JNZ     ??Serial_callBack_17
   \   000290   7421         MOV     A,#0x21
   \   000292   12....       LCALL   ?XSTACK_DISP0_8
   \   000295   E0           MOVX    A,@DPTR
   \   000296   6423         XRL     A,#0x23
   \   000298   6003         JZ      $+5
   \   00029A   02....       LJMP    ??Serial_callBack_18 & 0xFFFF
    376                {
    377                    uprint("EndDevice match");
   \   00029D                ; Setup parameters for call to function uprint
   \   00029D   7A..         MOV     R2,#`?<Constant "EndDevice match">` & 0xff
   \   00029F   7B..         MOV     R3,#(`?<Constant "EndDevice match">` >> 8) & 0xff
   \   0002A1   12....       LCALL   ??uprint?relay
    378                    HalLedSet ( HAL_LED_1, HAL_LED_MODE_OFF );
   \   0002A4                ; Setup parameters for call to function HalLedSet
   \   0002A4   7A00         MOV     R2,#0x0
   \   0002A6   7901         MOV     R1,#0x1
   \   0002A8   12....       LCALL   ??HalLedSet?relay
    379          
    380                    dstAddr.addrMode = Addr16Bit;
   \   0002AB   7413         MOV     A,#0x13
   \   0002AD   12....       LCALL   ?XSTACK_DISP0_8
   \   0002B0   7402         MOV     A,#0x2
   \   0002B2   F0           MOVX    @DPTR,A
    381                    dstAddr.addr.shortAddr = 0x0000; // Coordinator
   \   0002B3   740B         MOV     A,#0xb
   \   0002B5   12....       LCALL   ?XSTACK_DISP0_8
   \   0002B8   E4           CLR     A
   \   0002B9   F0           MOVX    @DPTR,A
   \   0002BA   A3           INC     DPTR
   \   0002BB   F0           MOVX    @DPTR,A
    382                    ZDP_EndDeviceBindReq( &dstAddr, NLME_GetShortAddr(), GenericApp_epDesc.endPoint,
    383                                      GENERICAPP_PROFID,
    384                                      GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    385                                      GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    386                                      FALSE );
   \   0002BC                ; Setup parameters for call to function NLME_GetShortAddr
   \   0002BC   12....       LCALL   ??NLME_GetShortAddr?relay
   \   0002BF   8A..         MOV     ?V0 + 2,R2
   \   0002C1   8B..         MOV     ?V0 + 3,R3
   \   0002C3   AC..         MOV     R4,?V0 + 2
   \   0002C5   AD..         MOV     R5,?V0 + 3
   \   0002C7   75....       MOV     ?V0 + 2,#GenericApp_ClusterList & 0xff
   \   0002CA   75....       MOV     ?V0 + 3,#(GenericApp_ClusterList >> 8) & 0xff
   \   0002CD                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   0002CD   75..00       MOV     ?V0 + 1,#0x0
   \   0002D0   78..         MOV     R0,#?V0 + 1
   \   0002D2   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0002D5   78..         MOV     R0,#?V0 + 2
   \   0002D7   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0002DA   75..01       MOV     ?V0 + 1,#0x1
   \   0002DD   78..         MOV     R0,#?V0 + 1
   \   0002DF   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0002E2   78..         MOV     R0,#?V0 + 2
   \   0002E4   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0002E7   78..         MOV     R0,#?V0 + 1
   \   0002E9   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0002EC   75..04       MOV     ?V0 + 2,#0x4
   \   0002EF   75..0F       MOV     ?V0 + 3,#0xf
   \   0002F2   78..         MOV     R0,#?V0 + 2
   \   0002F4   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0002F7   90....       MOV     DPTR,#GenericApp_epDesc
   \   0002FA   E0           MOVX    A,@DPTR
   \   0002FB   F9           MOV     R1,A
   \   0002FC   7414         MOV     A,#0x14
   \   0002FE   12....       LCALL   ?XSTACK_DISP0_8
   \   000301   AA82         MOV     R2,DPL
   \   000303   AB83         MOV     R3,DPH
   \   000305   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   000308   7409         MOV     A,#0x9
   \   00030A   12....       LCALL   ?DEALLOC_XSTACK8
    387                
    388                }
    389           
    390                if( buff[0] == 'r' && buff[1] == '#')
   \                     ??Serial_callBack_17:
   \   00030D   7420         MOV     A,#0x20
   \   00030F   12....       LCALL   ?XSTACK_DISP0_8
   \   000312   E0           MOVX    A,@DPTR
   \   000313   6472         XRL     A,#0x72
   \   000315   706C         JNZ     ??Serial_callBack_18
   \   000317   7421         MOV     A,#0x21
   \   000319   12....       LCALL   ?XSTACK_DISP0_8
   \   00031C   E0           MOVX    A,@DPTR
   \   00031D   6423         XRL     A,#0x23
   \   00031F   7062         JNZ     ??Serial_callBack_18
    391                {
    392                    uprint("Router Device match");
   \   000321                ; Setup parameters for call to function uprint
   \   000321   7A..         MOV     R2,#`?<Constant "Router Device match">` & 0xff
   \   000323   7B..         MOV     R3,#(`?<Constant "Router Device match">` >> 8) & 0xff
   \   000325   12....       LCALL   ??uprint?relay
    393                    
    394                  HalLedSet ( HAL_LED_1, HAL_LED_MODE_FLASH );
   \   000328                ; Setup parameters for call to function HalLedSet
   \   000328   7A04         MOV     R2,#0x4
   \   00032A   7901         MOV     R1,#0x1
   \   00032C   12....       LCALL   ??HalLedSet?relay
    395          
    396                dstAddr.addrMode = AddrBroadcast;
   \   00032F   7413         MOV     A,#0x13
   \   000331   12....       LCALL   ?XSTACK_DISP0_8
   \   000334   740F         MOV     A,#0xf
   \   000336   F0           MOVX    @DPTR,A
    397                dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
   \   000337   740B         MOV     A,#0xb
   \   000339   12....       LCALL   ?XSTACK_DISP0_8
   \   00033C   74FF         MOV     A,#-0x1
   \   00033E   F0           MOVX    @DPTR,A
   \   00033F   A3           INC     DPTR
   \   000340   F0           MOVX    @DPTR,A
    398                ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR,
    399                                  GENERICAPP_PROFID,
    400                                  GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    401                                  GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    402                                  FALSE );
   \   000341   75....       MOV     ?V0 + 2,#GenericApp_ClusterList & 0xff
   \   000344   75....       MOV     ?V0 + 3,#(GenericApp_ClusterList >> 8) & 0xff
   \   000347                ; Setup parameters for call to function ZDP_MatchDescReq
   \   000347   75..00       MOV     ?V0 + 1,#0x0
   \   00034A   78..         MOV     R0,#?V0 + 1
   \   00034C   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00034F   78..         MOV     R0,#?V0 + 2
   \   000351   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000354   75..01       MOV     ?V0 + 1,#0x1
   \   000357   78..         MOV     R0,#?V0 + 1
   \   000359   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00035C   78..         MOV     R0,#?V0 + 2
   \   00035E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000361   75..04       MOV     ?V0 + 2,#0x4
   \   000364   75..0F       MOV     ?V0 + 3,#0xf
   \   000367   78..         MOV     R0,#?V0 + 2
   \   000369   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00036C   7901         MOV     R1,#0x1
   \   00036E   7CFF         MOV     R4,#-0x1
   \   000370   7DFF         MOV     R5,#-0x1
   \   000372   7413         MOV     A,#0x13
   \   000374   12....       LCALL   ?XSTACK_DISP0_8
   \   000377   AA82         MOV     R2,DPL
   \   000379   AB83         MOV     R3,DPH
   \   00037B   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   00037E   7408         MOV     A,#0x8
   \   000380   12....       LCALL   ?DEALLOC_XSTACK8
    403                
    404                }
    405                if(readBytes == 6)
   \                     ??Serial_callBack_18:
   \   000383   7406         MOV     A,#0x6
   \   000385   65..         XRL     A,?V0 + 0
   \   000387   6003         JZ      $+5
   \   000389   02....       LJMP    ??Serial_callBack_19 & 0xFFFF
    406                {
    407                  if(buff[0] == 'p' && buff[1]==':') // pan id
   \   00038C   7420         MOV     A,#0x20
   \   00038E   12....       LCALL   ?XSTACK_DISP0_8
   \   000391   E0           MOVX    A,@DPTR
   \   000392   6470         XRL     A,#0x70
   \   000394   6003         JZ      $+5
   \   000396   02....       LJMP    ??Serial_callBack_19 & 0xFFFF
   \   000399   7421         MOV     A,#0x21
   \   00039B   12....       LCALL   ?XSTACK_DISP0_8
   \   00039E   E0           MOVX    A,@DPTR
   \   00039F   643A         XRL     A,#0x3a
   \   0003A1   6003         JZ      $+5
   \   0003A3   02....       LJMP    ??Serial_callBack_3 & 0xFFFF
    408                  {
    409                      strncpy(pbuf, &buff[2],2); pbuf[2] = '\0';
                                           ^
Warning[Pe167]: argument of type "unsigned char *" is incompatible with
          parameter of type "char const *"
   \   0003A6                ; Setup parameters for call to function strncpy
   \   0003A6   75..02       MOV     ?V0 + 2,#0x2
   \   0003A9   75..00       MOV     ?V0 + 3,#0x0
   \   0003AC   78..         MOV     R0,#?V0 + 2
   \   0003AE   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0003B1   7424         MOV     A,#0x24
   \   0003B3   12....       LCALL   ?XSTACK_DISP0_8
   \   0003B6   AC82         MOV     R4,DPL
   \   0003B8   AD83         MOV     R5,DPH
   \   0003BA   740A         MOV     A,#0xa
   \   0003BC   12....       LCALL   ?XSTACK_DISP0_8
   \   0003BF   AA82         MOV     R2,DPL
   \   0003C1   AB83         MOV     R3,DPH
   \   0003C3   12....       LCALL   ??strncpy?relay
   \   0003C6   7402         MOV     A,#0x2
   \   0003C8   12....       LCALL   ?DEALLOC_XSTACK8
   \   0003CB   740A         MOV     A,#0xa
   \   0003CD   12....       LCALL   ?XSTACK_DISP0_8
   \   0003D0   E4           CLR     A
   \   0003D1   F0           MOVX    @DPTR,A
    410                      strncpy(pbuf1, &buff[4],2); pbuf1[2] = '\0';
                                            ^
Warning[Pe167]: argument of type "unsigned char *" is incompatible with
          parameter of type "char const *"

    char theMessageData[] = "Hello";
         ^
"D:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\WeiYi\Source\GenericApp.c",201  Warning[Pe177]: 
          variable "theMessageData" was declared but never referenced

    zAddrType_t ZAddr;
                ^
"D:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\WeiYi\Source\GenericApp.c",203  Warning[Pe177]: 
          variable "ZAddr" was declared but never referenced

    uint16 *p1;
            ^
"D:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\WeiYi\Source\GenericApp.c",218  Warning[Pe177]: 
          variable "p1" was declared but never referenced

    byte cnt = 0;
         ^
"D:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\WeiYi\Source\GenericApp.c",220  Warning[Pe177]: 
          variable "cnt" was declared but never referenced

    associated_devices_t *adp; // delete devices
                          ^
"D:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\WeiYi\Source\GenericApp.c",227  Warning[Pe177]: 
          variable "adp" was declared but never referenced

    uint8 startOptions;    
          ^
"D:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\WeiYi\Source\GenericApp.c",230  Warning[Pe177]: 
          variable "startOptions" was declared but never referenced

    uint8 logicalType;
          ^
"D:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\Samples\WeiYi\Source\GenericApp.c",231  Warning[Pe550]: 
          variable "logicalType" was set but never used
   \   0003D2                ; Setup parameters for call to function strncpy
   \   0003D2   78..         MOV     R0,#?V0 + 2
   \   0003D4   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0003D7   7426         MOV     A,#0x26
   \   0003D9   12....       LCALL   ?XSTACK_DISP0_8
   \   0003DC   AC82         MOV     R4,DPL
   \   0003DE   AD83         MOV     R5,DPH
   \   0003E0   7407         MOV     A,#0x7
   \   0003E2   12....       LCALL   ?XSTACK_DISP0_8
   \   0003E5   AA82         MOV     R2,DPL
   \   0003E7   AB83         MOV     R3,DPH
   \   0003E9   12....       LCALL   ??strncpy?relay
   \   0003EC   7402         MOV     A,#0x2
   \   0003EE   12....       LCALL   ?DEALLOC_XSTACK8
   \   0003F1   7407         MOV     A,#0x7
   \   0003F3   12....       LCALL   ?XSTACK_DISP0_8
   \   0003F6   E4           CLR     A
   \   0003F7   F0           MOVX    @DPTR,A
    411                      
    412                      set_panid( BUILD_UINT16( strtol(pbuf1,NULL,16),strtol(pbuf,NULL,16) ));
   \   0003F8                ; Setup parameters for call to function strtol
   \   0003F8   75..10       MOV     ?V0 + 2,#0x10
   \   0003FB   78..         MOV     R0,#?V0 + 2
   \   0003FD   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000400   7C00         MOV     R4,#0x0
   \   000402   7D00         MOV     R5,#0x0
   \   000404   7407         MOV     A,#0x7
   \   000406   12....       LCALL   ?XSTACK_DISP0_8
   \   000409   AA82         MOV     R2,DPL
   \   00040B   AB83         MOV     R3,DPH
   \   00040D   12....       LCALL   ??strtol?relay
   \   000410   7402         MOV     A,#0x2
   \   000412   12....       LCALL   ?DEALLOC_XSTACK8
   \   000415                ; Setup parameters for call to function set_panid
   \   000415   EA           MOV     A,R2
   \   000416   FE           MOV     R6,A
   \   000417                ; Setup parameters for call to function strtol
   \   000417   78..         MOV     R0,#?V0 + 2
   \   000419   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00041C   7C00         MOV     R4,#0x0
   \   00041E   7D00         MOV     R5,#0x0
   \   000420   740A         MOV     A,#0xa
   \   000422   12....       LCALL   ?XSTACK_DISP0_8
   \   000425   AA82         MOV     R2,DPL
   \   000427   AB83         MOV     R3,DPH
   \   000429   12....       LCALL   ??strtol?relay
   \   00042C   7402         MOV     A,#0x2
   \   00042E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000431   EA           MOV     A,R2
   \   000432   F5..         MOV     ?V0 + 5,A
   \   000434   EE           MOV     A,R6
   \   000435   2400         ADD     A,#0x0
   \   000437   FA           MOV     R2,A
   \   000438   E4           CLR     A
   \   000439   35..         ADDC    A,?V0 + 5
   \   00043B   FB           MOV     R3,A
   \   00043C   12....       LCALL   ??set_panid?relay
    413                      if(_NIB.nwkPanId == 0xffff)
   \   00043F   90....       MOV     DPTR,#_NIB + 33
   \   000442   E0           MOVX    A,@DPTR
   \   000443   F4           CPL     A
   \   000444   7003         JNZ     ??Serial_callBack_20
   \   000446   A3           INC     DPTR
   \   000447   E0           MOVX    A,@DPTR
   \   000448   F4           CPL     A
   \                     ??Serial_callBack_20:
   \   000449   7013         JNZ     ??Serial_callBack_19
    414                      {
    415                        zgWriteStartupOptions (ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE);           
   \   00044B                ; Setup parameters for call to function zgWriteStartupOptions
   \   00044B   7A02         MOV     R2,#0x2
   \   00044D   79FF         MOV     R1,#-0x1
   \   00044F   12....       LCALL   ??zgWriteStartupOptions?relay
    416                        SystemReset();
   \   000452   C2AF         CLR     0xa8.7
   \   000454   C2AF         CLR     0xa8.7
   \   000456   75C9AB       MOV     0xc9,#-0x55
   \   000459   75C95B       MOV     0xc9,#0x5b
   \                     ??Serial_callBack_21:
   \   00045C   80FE         SJMP    ??Serial_callBack_21
    417                      }            
    418                      //SystemResetSoft();
    419                  }
    420                  
    421                  if(buff[0] == 's' && buff[1]==':') // short address
    422                  {
    423                      /*
    424                      strncpy(pbuf, &buff[2],2); pbuf[2] = '\0';
    425                      strncpy(pbuf1, &buff[4],2); pbuf1[2] = '\0';
    426                      _NIB.nwkDevAddress = BUILD_UINT16( strtol(pbuf1,NULL,16),strtol(pbuf,NULL,16));
    427                      */
    428                      
    429                  }
    430                }
    431                
    432                
    433                cmd = BUILD_UINT16(buff[ 1 + 1], buff[1]);
    434                if( ( buff[ 0 ] == CPT_SOP) && (cmd == SYS_PING_REQUEST) ) 
   \                     ??Serial_callBack_19:
   \   00045E   7420         MOV     A,#0x20
   \   000460   12....       LCALL   ?XSTACK_DISP0_8
   \   000463   E0           MOVX    A,@DPTR
   \   000464   64FE         XRL     A,#0xfe
   \   000466   701E         JNZ     ??Serial_callBack_22
   \   000468   7422         MOV     A,#0x22
   \   00046A   12....       LCALL   ?XSTACK_DISP0_8
   \   00046D   E0           MOVX    A,@DPTR
   \   00046E   FA           MOV     R2,A
   \   00046F   7421         MOV     A,#0x21
   \   000471   12....       LCALL   ?XSTACK_DISP0_8
   \   000474   E0           MOVX    A,@DPTR
   \   000475   F9           MOV     R1,A
   \   000476   EA           MOV     A,R2
   \   000477   F8           MOV     R0,A
   \   000478   7421         MOV     A,#0x21
   \   00047A   68           XRL     A,R0
   \   00047B   7001         JNZ     ??Serial_callBack_23
   \   00047D   E9           MOV     A,R1
   \                     ??Serial_callBack_23:
   \   00047E   7006         JNZ     ??Serial_callBack_22
    435                {
    436                  sysPingReqRcvd();
   \   000480                ; Setup parameters for call to function sysPingReqRcvd
   \   000480   12....       LCALL   ??sysPingReqRcvd?relay
    437                  return;
   \   000483   02....       LJMP    ??Serial_callBack_0 & 0xFFFF
    438                }
    439          
    440                if( readBytes == 2)
   \                     ??Serial_callBack_22:
   \   000486   7402         MOV     A,#0x2
   \   000488   65..         XRL     A,?V0 + 0
   \   00048A   6003         JZ      $+5
   \   00048C   02....       LJMP    ??Serial_callBack_3 & 0xFFFF
    441                {        
    442                  if( buff[0] == 0xcc )
   \   00048F   7420         MOV     A,#0x20
   \   000491   12....       LCALL   ?XSTACK_DISP0_8
   \   000494   E0           MOVX    A,@DPTR
   \   000495   64CC         XRL     A,#0xcc
   \   000497   6003         JZ      $+5
   \   000499   02....       LJMP    ??Serial_callBack_3 & 0xFFFF
    443                  {
    444                    if( buff[1] > 0x0a && buff[1] < 0x1b )
   \   00049C   7421         MOV     A,#0x21
   \   00049E   12....       LCALL   ?XSTACK_DISP0_8
   \   0004A1   E0           MOVX    A,@DPTR
   \   0004A2   24F5         ADD     A,#-0xb
   \   0004A4   C3           CLR     C
   \   0004A5   9410         SUBB    A,#0x10
   \   0004A7   4003         JC      $+5
   \   0004A9   02....       LJMP    ??Serial_callBack_3 & 0xFFFF
    445                    {
    446          
    447                      _NIB.nwkLogicalChannel = buff[1];
   \   0004AC   E0           MOVX    A,@DPTR
   \   0004AD   90....       MOV     DPTR,#_NIB + 22
   \   0004B0   F0           MOVX    @DPTR,A
    448                      NLME_UpdateNV(0x01);
   \   0004B1                ; Setup parameters for call to function NLME_UpdateNV
   \   0004B1   7901         MOV     R1,#0x1
   \   0004B3   12....       LCALL   ??NLME_UpdateNV?relay
    449                      ZMacSetReq( ZMacChannel, &buff[1]);
   \   0004B6                ; Setup parameters for call to function ZMacSetReq
   \   0004B6   7421         MOV     A,#0x21
   \   0004B8   12....       LCALL   ?XSTACK_DISP0_8
   \   0004BB   AA82         MOV     R2,DPL
   \   0004BD   AB83         MOV     R3,DPH
   \   0004BF   79E1         MOV     R1,#-0x1f
   \   0004C1   12....       LCALL   ??ZMacSetReq?relay
    450                      
    451                      osal_nv_item_init( ZCD_NV_CHANLIST, sizeof(zgDefaultChannelList), &zgDefaultChannelList);
   \   0004C4                ; Setup parameters for call to function osal_nv_item_init
   \   0004C4   75....       MOV     ?V0 + 2,#zgDefaultChannelList & 0xff
   \   0004C7   75....       MOV     ?V0 + 3,#(zgDefaultChannelList >> 8) & 0xff
   \   0004CA   78..         MOV     R0,#?V0 + 2
   \   0004CC   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0004CF   7C04         MOV     R4,#0x4
   \   0004D1   7D00         MOV     R5,#0x0
   \   0004D3   7A84         MOV     R2,#-0x7c
   \   0004D5   7B00         MOV     R3,#0x0
   \   0004D7   12....       LCALL   ??osal_nv_item_init?relay
   \   0004DA   7402         MOV     A,#0x2
   \   0004DC   12....       LCALL   ?DEALLOC_XSTACK8
    452                      
    453                      if( buff[1] == 0x0b)
   \   0004DF   7421         MOV     A,#0x21
   \   0004E1   12....       LCALL   ?XSTACK_DISP0_8
   \   0004E4   E0           MOVX    A,@DPTR
   \   0004E5   640B         XRL     A,#0xb
   \   0004E7   7006         JNZ     ??Serial_callBack_24
    454                      {
    455                        zgDefaultChannelList = 0x00000800;
   \   0004E9   90....       MOV     DPTR,#__Constant_800
   \   0004EC   02....       LJMP    ??Serial_callBack_25 & 0xFFFF
    456                        
    457                      } 
    458                      if (buff[1] == 0x0c )
   \                     ??Serial_callBack_24:
   \   0004EF   E0           MOVX    A,@DPTR
   \   0004F0   640C         XRL     A,#0xc
   \   0004F2   7006         JNZ     ??Serial_callBack_26
    459                      {
    460                        zgDefaultChannelList = 0x00001000;
   \   0004F4   90....       MOV     DPTR,#__Constant_1000
   \   0004F7   02....       LJMP    ??Serial_callBack_25 & 0xFFFF
    461                      }            
    462                      if (buff[1] == 0x0d )
   \                     ??Serial_callBack_26:
   \   0004FA   E0           MOVX    A,@DPTR
   \   0004FB   640D         XRL     A,#0xd
   \   0004FD   7006         JNZ     ??Serial_callBack_27
    463                      {
    464                        zgDefaultChannelList = 0x00002000;
   \   0004FF   90....       MOV     DPTR,#__Constant_2000
   \   000502   02....       LJMP    ??Serial_callBack_25 & 0xFFFF
    465                      }
    466                      if (buff[1] == 0x0e )
   \                     ??Serial_callBack_27:
   \   000505   E0           MOVX    A,@DPTR
   \   000506   640E         XRL     A,#0xe
   \   000508   7005         JNZ     ??Serial_callBack_28
    467                      {
    468                        zgDefaultChannelList = 0x00004000;
   \   00050A   90....       MOV     DPTR,#__Constant_4000
   \   00050D   8076         SJMP    ??Serial_callBack_25
    469                      }
    470                      if (buff[1] == 0x0f )
   \                     ??Serial_callBack_28:
   \   00050F   E0           MOVX    A,@DPTR
   \   000510   640F         XRL     A,#0xf
   \   000512   7005         JNZ     ??Serial_callBack_29
    471                      {
    472                        zgDefaultChannelList = 0x00008000;
   \   000514   90....       MOV     DPTR,#__Constant_8000
   \   000517   806C         SJMP    ??Serial_callBack_25
    473                      }
    474                      if (buff[1] == 0x10 )
   \                     ??Serial_callBack_29:
   \   000519   E0           MOVX    A,@DPTR
   \   00051A   6410         XRL     A,#0x10
   \   00051C   7005         JNZ     ??Serial_callBack_30
    475                      {
    476                        zgDefaultChannelList = 0x00010000;
   \   00051E   90....       MOV     DPTR,#__Constant_10000
   \   000521   8062         SJMP    ??Serial_callBack_25
    477                      }
    478                      if (buff[1] == 0x11 )
   \                     ??Serial_callBack_30:
   \   000523   E0           MOVX    A,@DPTR
   \   000524   6411         XRL     A,#0x11
   \   000526   7005         JNZ     ??Serial_callBack_31
    479                      {
    480                        zgDefaultChannelList = 0x00020000;
   \   000528   90....       MOV     DPTR,#__Constant_20000
   \   00052B   8058         SJMP    ??Serial_callBack_25
    481                      }
    482                      if (buff[1] == 0x12 )
   \                     ??Serial_callBack_31:
   \   00052D   E0           MOVX    A,@DPTR
   \   00052E   6412         XRL     A,#0x12
   \   000530   7005         JNZ     ??Serial_callBack_32
    483                      {
    484                        zgDefaultChannelList = 0x00040000;
   \   000532   90....       MOV     DPTR,#__Constant_40000
   \   000535   804E         SJMP    ??Serial_callBack_25
    485                      }            
    486                      if (buff[1] == 0x13 )
   \                     ??Serial_callBack_32:
   \   000537   E0           MOVX    A,@DPTR
   \   000538   6413         XRL     A,#0x13
   \   00053A   7005         JNZ     ??Serial_callBack_33
    487                      {
    488                        zgDefaultChannelList = 0x00080000;
   \   00053C   90....       MOV     DPTR,#__Constant_80000
   \   00053F   8044         SJMP    ??Serial_callBack_25
    489                      }
    490                      if (buff[1] == 0x14 )
   \                     ??Serial_callBack_33:
   \   000541   E0           MOVX    A,@DPTR
   \   000542   6414         XRL     A,#0x14
   \   000544   7005         JNZ     ??Serial_callBack_34
    491                      {
    492                        zgDefaultChannelList = 0x00100000;
   \   000546   90....       MOV     DPTR,#__Constant_100000
   \   000549   803A         SJMP    ??Serial_callBack_25
    493                      }
    494                      if (buff[1] == 0x15 )
   \                     ??Serial_callBack_34:
   \   00054B   E0           MOVX    A,@DPTR
   \   00054C   6415         XRL     A,#0x15
   \   00054E   7005         JNZ     ??Serial_callBack_35
    495                      {
    496                        zgDefaultChannelList = 0x00200000;
   \   000550   90....       MOV     DPTR,#__Constant_200000
   \   000553   8030         SJMP    ??Serial_callBack_25
    497                      }            
    498                      if (buff[1] == 0x16 )
   \                     ??Serial_callBack_35:
   \   000555   E0           MOVX    A,@DPTR
   \   000556   6416         XRL     A,#0x16
   \   000558   7005         JNZ     ??Serial_callBack_36
    499                      {
    500                        zgDefaultChannelList = 0x00400000;
   \   00055A   90....       MOV     DPTR,#__Constant_400000
   \   00055D   8026         SJMP    ??Serial_callBack_25
    501                      }
    502                      if (buff[1] == 0x17 )
   \                     ??Serial_callBack_36:
   \   00055F   E0           MOVX    A,@DPTR
   \   000560   6417         XRL     A,#0x17
   \   000562   7005         JNZ     ??Serial_callBack_37
    503                      {
    504                        zgDefaultChannelList = 0x00800000;
   \   000564   90....       MOV     DPTR,#__Constant_800000
   \   000567   801C         SJMP    ??Serial_callBack_25
    505                      }
    506                      if (buff[1] == 0x18 )
   \                     ??Serial_callBack_37:
   \   000569   E0           MOVX    A,@DPTR
   \   00056A   6418         XRL     A,#0x18
   \   00056C   7005         JNZ     ??Serial_callBack_38
    507                      {
    508                        zgDefaultChannelList = 0x01000000;
   \   00056E   90....       MOV     DPTR,#__Constant_1000000
   \   000571   8012         SJMP    ??Serial_callBack_25
    509                      }
    510          
    511                      if (buff[1] == 0x19 )
   \                     ??Serial_callBack_38:
   \   000573   E0           MOVX    A,@DPTR
   \   000574   6419         XRL     A,#0x19
   \   000576   7005         JNZ     ??Serial_callBack_39
    512                      {
    513                        zgDefaultChannelList = 0x02000000;
   \   000578   90....       MOV     DPTR,#__Constant_2000000
   \   00057B   8008         SJMP    ??Serial_callBack_25
    514                      }
    515                      if (buff[1] == 0x1a )
   \                     ??Serial_callBack_39:
   \   00057D   E0           MOVX    A,@DPTR
   \   00057E   641A         XRL     A,#0x1a
   \   000580   700C         JNZ     ??Serial_callBack_40
    516                      {
    517                        zgDefaultChannelList = 0x04000000;
   \   000582   90....       MOV     DPTR,#__Constant_4000000
   \                     ??Serial_callBack_25:
   \   000585   12....       LCALL   ?XLOAD_R2345
   \   000588   90....       MOV     DPTR,#zgDefaultChannelList
   \   00058B   12....       LCALL   ?XSTORE_R2345
    518                      }
    519                      
    520                      osal_nv_write(  ZCD_NV_CHANLIST, 0 ,sizeof(zgDefaultChannelList), &zgDefaultChannelList);
   \                     ??Serial_callBack_40:
   \   00058E                ; Setup parameters for call to function osal_nv_write
   \   00058E   78..         MOV     R0,#?V0 + 2
   \   000590   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000593   75..04       MOV     ?V0 + 2,#0x4
   \   000596   75..00       MOV     ?V0 + 3,#0x0
   \   000599   78..         MOV     R0,#?V0 + 2
   \   00059B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00059E   7C00         MOV     R4,#0x0
   \   0005A0   7D00         MOV     R5,#0x0
   \   0005A2   7A84         MOV     R2,#-0x7c
   \   0005A4   7B00         MOV     R3,#0x0
   \   0005A6   12....       LCALL   ??osal_nv_write?relay
   \   0005A9   7404         MOV     A,#0x4
   \   0005AB   12....       LCALL   ?DEALLOC_XSTACK8
    521                      
    522                      UART_Send_String( (uint8*)&zgDefaultChannelList, sizeof(zgDefaultChannelList) );
   \   0005AE                ; Setup parameters for call to function UART_Send_String
   \   0005AE   7C04         MOV     R4,#0x4
   \   0005B0   7D00         MOV     R5,#0x0
   \   0005B2   7A..         MOV     R2,#zgDefaultChannelList & 0xff
   \   0005B4   7B..         MOV     R3,#(zgDefaultChannelList >> 8) & 0xff
   \   0005B6   12....       LCALL   ??UART_Send_String?relay
    523          
    524                      /*
    525                      _NIB.nwkLogicalChannel = buff[1];
    526                      NLME_UpdateNV(0x01);
    527                      if( osal_nv_write(ZCD_NV_CHANLIST, 0, osal_nv_item_len( ZCD_NV_CHANLIST ), &tmp32) !=  ZSUCCESS)
    528                      {
    529                        uprint("change channel to nv failed");
    530                      }
    531                      */
    532                      /*
    533                      _NIB.nwkLogicalChannel = buff[1];
    534                      ZMacSetReq( ZMacChannel, &buff[1]);
    535                      ZDApp_NwkStateUpdateCB();
    536                      _NIB.nwkTotalTransmissions = 0;
    537                      nwkTransmissionFailures( TRUE );
    538                      */
    539                    }
    540                  }
    541                  
    542                }// readBytes==2
    543          
    544          
    545                ser_process( buff,readBytes );// ÖÐÑ¶ÍþÒ×µÄÐ­Òé×îÐ¡Ò²ÊÇ2 ×Ö½Ú
   \                     ??Serial_callBack_3:
   \   0005B9                ; Setup parameters for call to function ser_process
   \   0005B9   A9..         MOV     R1,?V0 + 0
   \   0005BB   7420         MOV     A,#0x20
   \   0005BD   12....       LCALL   ?XSTACK_DISP0_8
   \   0005C0   AA82         MOV     R2,DPL
   \   0005C2   AB83         MOV     R3,DPH
   \   0005C4   12....       LCALL   ??ser_process?relay
    546              }//if( readBytes >= 2)
    547          
    548          
    549              AF_DataRequest( &GenericApp_DstAddr, &GenericApp_epDesc,
    550                                 GENERICAPP_CLUSTERID,
    551                                 readBytes,
    552                                 (byte *)&buff,
    553                                 &GenericApp_TransID,
    554                                 AF_DISCV_ROUTE, AF_DEFAULT_RADIUS );
   \                     ??Serial_callBack_11:
   \   0005C7                ; Setup parameters for call to function AF_DataRequest
   \   0005C7   75..1E       MOV     ?V0 + 1,#0x1e
   \   0005CA   78..         MOV     R0,#?V0 + 1
   \   0005CC   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0005CF   75....       MOV     ?V0 + 2,#GenericApp_TransID & 0xff
   \   0005D2   75....       MOV     ?V0 + 3,#(GenericApp_TransID >> 8) & 0xff
   \   0005D5   78..         MOV     R0,#?V0 + 2
   \   0005D7   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0005DA   7423         MOV     A,#0x23
   \   0005DC   12....       LCALL   ?XSTACK_DISP0_8
   \   0005DF   8582..       MOV     ?V0 + 2,DPL
   \   0005E2   8583..       MOV     ?V0 + 3,DPH
   \   0005E5   78..         MOV     R0,#?V0 + 2
   \   0005E7   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0005EA   75..00       MOV     ?V0 + 1,#0x0
   \   0005ED   78..         MOV     R0,#?V0 + 0
   \   0005EF   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0005F2   75..01       MOV     ?V0 + 0,#0x1
   \   0005F5   78..         MOV     R0,#?V0 + 0
   \   0005F7   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0005FA   7920         MOV     R1,#0x20
   \   0005FC   7C..         MOV     R4,#GenericApp_epDesc & 0xff
   \   0005FE   7D..         MOV     R5,#(GenericApp_epDesc >> 8) & 0xff
   \   000600   7A..         MOV     R2,#GenericApp_DstAddr & 0xff
   \   000602   7B..         MOV     R3,#(GenericApp_DstAddr >> 8) & 0xff
    555              
    556                
    557            } //if (readBytes > 0) 
   \                     ??Serial_callBack_16:
   \   000604   12....       LCALL   ??Subroutine11_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_18:
   \   000607   12....       LCALL   ?DEALLOC_XSTACK8
   \                     ??Serial_callBack_0:
   \   00060A   74CC         MOV     A,#-0x34
   \   00060C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00060F   7F08         MOV     R7,#0x8
   \   000611   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   000614                REQUIRE _A_IEN0
   \   000614                REQUIRE WDCTL
    558          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   E8           MOV     A,R0
   \   000001   F0           MOVX    @DPTR,A
   \   000002   A3           INC     DPTR
   \   000003   E9           MOV     A,R1
   \   000004   F0           MOVX    @DPTR,A
   \   000005                ; Setup parameters for call to function UART_Send_String
   \   000005                ; Setup parameters for call to function UART_Send_String
   \   000005   7C02         MOV     R4,#0x2
   \   000007   7D00         MOV     R5,#0x0
   \   000009   22           RET
    559          
    560          /*********************************************************************
    561           * LOCAL FUNCTIONS
    562           */
    563          static void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    564          static void GenericApp_HandleKeys( byte shift, byte keys );
    565          static void GenericApp_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    566          static void GenericApp_SendTheMessage( void );
    567          
    568          #if defined( IAR_ARMCM3_LM )
    569          static void GenericApp_ProcessRtosMessage( void );
    570          #endif
    571          
    572          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    573          void GenericApp_Init( uint8 task_id )
   \                     GenericApp_Init:
    574          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    575            uint16 size;
    576            
    577            GenericApp_TaskID = task_id;
   \   000006   90....       MOV     DPTR,#GenericApp_TaskID
   \   000009   F0           MOVX    @DPTR,A
    578            GenericApp_NwkState = DEV_INIT;
   \   00000A   90....       MOV     DPTR,#GenericApp_NwkState
   \   00000D   7401         MOV     A,#0x1
   \   00000F   F0           MOVX    @DPTR,A
    579            GenericApp_TransID = 0;
   \   000010   90....       MOV     DPTR,#GenericApp_TransID
   \   000013   E4           CLR     A
   \   000014   F0           MOVX    @DPTR,A
    580            
    581            uint8 networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
                         ^
Warning[Pe177]: variable "networkStateNV" was declared but never referenced
    582            devStartModes_t devStartMode = MODE_RESUME; 
                                   ^
Warning[Pe177]: variable "devStartMode" was declared but never referenced
    583            
    584          
    585            //GenericApp_DstAddr.addrMode = (afAddrMode_t)AddrNotPresent; //(afAddrMode_t)Addr16Bit;
    586            GenericApp_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   000015   90....       MOV     DPTR,#GenericApp_DstAddr + 8
   \   000018   7402         MOV     A,#0x2
   \   00001A   F0           MOVX    @DPTR,A
    587            GenericApp_DstAddr.endPoint = GENERICAPP_ENDPOINT;
   \   00001B   A3           INC     DPTR
   \   00001C   740A         MOV     A,#0xa
   \   00001E   12....       LCALL   ?Subroutine1 & 0xFFFF
    588            GenericApp_DstAddr.addr.shortAddr = 0xFFFF;
    589          
    590            // Fill out the endpoint description.
    591            GenericApp_epDesc.endPoint = GENERICAPP_ENDPOINT;
   \                     ??CrossCallReturnLabel_0:
   \   000021   90....       MOV     DPTR,#GenericApp_epDesc
   \   000024   740A         MOV     A,#0xa
   \   000026   F0           MOVX    @DPTR,A
    592            GenericApp_epDesc.task_id = &GenericApp_TaskID;
   \   000027   A3           INC     DPTR
   \   000028   74..         MOV     A,#GenericApp_TaskID & 0xff
   \   00002A   F0           MOVX    @DPTR,A
   \   00002B   A3           INC     DPTR
   \   00002C   74..         MOV     A,#(GenericApp_TaskID >> 8) & 0xff
   \   00002E   F0           MOVX    @DPTR,A
    593            GenericApp_epDesc.simpleDesc
    594                      = (SimpleDescriptionFormat_t *)&GenericApp_SimpleDesc;
   \   00002F   A3           INC     DPTR
   \   000030   74..         MOV     A,#GenericApp_SimpleDesc & 0xff
   \   000032   F0           MOVX    @DPTR,A
   \   000033   A3           INC     DPTR
   \   000034   74..         MOV     A,#(GenericApp_SimpleDesc >> 8) & 0xff
   \   000036   F0           MOVX    @DPTR,A
    595            GenericApp_epDesc.latencyReq = noLatencyReqs;
   \   000037   A3           INC     DPTR
   \   000038   E4           CLR     A
   \   000039   F0           MOVX    @DPTR,A
    596          
    597            // Register the endpoint description with the AF
    598            afRegister( &GenericApp_epDesc );
   \   00003A                ; Setup parameters for call to function afRegister
   \   00003A   7A..         MOV     R2,#GenericApp_epDesc & 0xff
   \   00003C   7B..         MOV     R3,#(GenericApp_epDesc >> 8) & 0xff
   \   00003E   12....       LCALL   ??afRegister?relay
    599          
    600            // Register for all key events - This app will handle all key events
    601            RegisterForKeys( GenericApp_TaskID );
   \   000041                ; Setup parameters for call to function RegisterForKeys
   \   000041   90....       MOV     DPTR,#GenericApp_TaskID
   \   000044   E0           MOVX    A,@DPTR
   \   000045   F9           MOV     R1,A
   \   000046   12....       LCALL   ??RegisterForKeys?relay
    602          
    603            // Update the display
    604          #if defined ( LCD_SUPPORTED )
    605            HalLcdWriteString( "GenericApp", HAL_LCD_LINE_1 );
   \   000049                ; Setup parameters for call to function HalLcdWriteString
   \   000049   7901         MOV     R1,#0x1
   \   00004B   7A..         MOV     R2,#`?<Constant "GenericApp">` & 0xff
   \   00004D   7B..         MOV     R3,#(`?<Constant "GenericApp">` >> 8) & 0xff
   \   00004F   12....       LCALL   ??HalLcdWriteString?relay
    606          #endif
    607          
    608            
    609          #if !defined( ZDO_COORDINATOR )
    610            ZDO_RegisterForZDOMsg( GenericApp_TaskID, End_Device_Bind_rsp );
    611            ZDO_RegisterForZDOMsg( GenericApp_TaskID, Match_Desc_rsp );
    612            
    613          #endif
    614            
    615          #if defined ( BUILD_ALL_DEVICES )
    616            size = osal_nv_item_len( ZCD_NV_LOGICAL_TYPE );
   \   000052                ; Setup parameters for call to function osal_nv_item_len
   \   000052   7A87         MOV     R2,#-0x79
   \   000054   7B00         MOV     R3,#0x0
   \   000056   12....       LCALL   ??osal_nv_item_len?relay
   \   000059   8A..         MOV     ?V0 + 0,R2
   \   00005B   8B..         MOV     ?V0 + 1,R3
   \   00005D   A8..         MOV     R0,?V0 + 0
   \   00005F   A9..         MOV     R1,?V0 + 1
    617            if( size  <= sizeof(zgDeviceLogicalType) && size != 0 )
   \   000061   C3           CLR     C
   \   000062   E8           MOV     A,R0
   \   000063   9402         SUBB    A,#0x2
   \   000065   E9           MOV     A,R1
   \   000066   9400         SUBB    A,#0x0
   \   000068   500F         JNC     ??GenericApp_Init_0
   \   00006A   E8           MOV     A,R0
   \   00006B   49           ORL     A,R1
   \   00006C   600B         JZ      ??GenericApp_Init_0
    618            {
    619              cb_ReadConfiguration( ZCD_NV_LOGICAL_TYPE, sizeof(zgDeviceLogicalType), &zgDeviceLogicalType);
   \   00006E                ; Setup parameters for call to function cb_ReadConfiguration
   \   00006E   7C..         MOV     R4,#zgDeviceLogicalType & 0xff
   \   000070   7D..         MOV     R5,#(zgDeviceLogicalType >> 8) & 0xff
   \   000072   7A01         MOV     R2,#0x1
   \   000074   7987         MOV     R1,#-0x79
   \   000076   12....       LCALL   ??cb_ReadConfiguration?relay
    620            }
    621            
    622          #endif
    623          
    624          #if defined ( HOLD_AUTO_START )
    625            if(start_flag == 1)
   \                     ??GenericApp_Init_0:
   \   000079   90....       MOV     DPTR,#start_flag
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   6401         XRL     A,#0x1
   \   00007F   7007         JNZ     ??GenericApp_Init_1
    626            {
    627                ZDOInitDevice(0);
   \   000081                ; Setup parameters for call to function ZDOInitDevice
   \   000081   7A00         MOV     R2,#0x0
   \   000083   7B00         MOV     R3,#0x0
   \   000085   12....       LCALL   ??ZDOInitDevice?relay
    628            }
    629          #endif
    630            serial_init();
   \                     ??GenericApp_Init_1:
   \   000088                ; Setup parameters for call to function serial_init
   \   000088   12....       LCALL   ??serial_init?relay
    631            
    632            init_cc2530();
   \   00008B                ; Setup parameters for call to function init_cc2530
   \   00008B   12....       LCALL   ??init_cc2530?relay
    633            
    634            HalLedSet( HAL_LED_2, HAL_LED_MODE_ON );
   \   00008E                ; Setup parameters for call to function HalLedSet
   \   00008E   7A01         MOV     R2,#0x1
   \   000090   7902         MOV     R1,#0x2
   \   000092   12....       LCALL   ??HalLedSet?relay
    635            
    636          }
   \   000095   7F02         MOV     R7,#0x2
   \   000097   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   90....       MOV     DPTR,#GenericApp_DstAddr
   \   000004   74FF         MOV     A,#-0x1
   \   000006   F0           MOVX    @DPTR,A
   \   000007   A3           INC     DPTR
   \   000008   F0           MOVX    @DPTR,A
   \   000009   22           RET
    637          
    638          /*********************************************************************
    639           * @fn      GenericApp_ProcessEvent
    640           *
    641           * @brief   Generic Application Task event processor.  This function
    642           *          is called to process all events for the task.  Events
    643           *          include timers, messages and any other user defined events.
    644           *
    645           * @param   task_id  - The OSAL assigned task ID.
    646           * @param   events - events to process.  This is a bit map and can
    647           *                   contain more than one event.
    648           *
    649           * @return  none
    650           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    651          uint16 GenericApp_ProcessEvent( uint8 task_id, uint16 events )
   \                     GenericApp_ProcessEvent:
    652          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 12
   \   000005   74F4         MOV     A,#-0xc
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
    653            afIncomingMSGPacket_t *MSGpkt;
    654            afDataConfirm_t *afDataConfirm;
    655          
    656            // Data Confirmation message fields
    657            byte sentEP;
    658            ZStatus_t sentStatus;
    659            byte sentTransID;       // This should match the value sent
    660            (void)task_id;  // Intentionally unreferenced parameter
    661          
    662            if ( events & SYS_EVENT_MSG )
   \   00000E   EB           MOV     A,R3
   \   00000F   5480         ANL     A,#0x80
   \   000011   7003         JNZ     $+5
   \   000013   02....       LJMP    ??GenericApp_ProcessEvent_0 & 0xFFFF
    663            {
    664              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( GenericApp_TaskID );
   \   000016                ; Setup parameters for call to function osal_msg_receive
   \   000016   8024         SJMP    ??GenericApp_ProcessEvent_1
    665              while ( MSGpkt )
    666              {
    667                switch ( MSGpkt->hdr.event )
    668                {
    669                  case ZDO_CB_MSG:
    670                    GenericApp_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    671                    break;
    672          
    673                  case KEY_CHANGE:
    674                    GenericApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    675                    break;
    676          
    677                  case AF_DATA_CONFIRM_CMD:
    678                    afDataConfirm = (afDataConfirm_t *)MSGpkt;
    679                    sentEP = afDataConfirm->endpoint;
    680                    sentStatus = afDataConfirm->hdr.status;
    681                    sentTransID = afDataConfirm->transID;
    682                    (void)sentEP;
    683                    (void)sentTransID;
    684          
    685                    // Action taken when confirmation is received.
    686                    if ( sentStatus != ZSuccess )
    687                    {
    688                      
    689                    }
    690                    break;
    691          
    692                  case AF_INCOMING_MSG_CMD:
    693                    GenericApp_MessageMSGCB( MSGpkt );
    694                    
    695                    
    696                    break;
    697          
    698                  case ZDO_STATE_CHANGE:
    699                    GenericApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
   \                     ??GenericApp_ProcessEvent_2:
   \   000018   A3           INC     DPTR
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   90....       MOV     DPTR,#GenericApp_NwkState
   \   00001D   F0           MOVX    @DPTR,A
    700                    if ( (GenericApp_NwkState == DEV_ZB_COORD)
    701                        || (GenericApp_NwkState == DEV_ROUTER)
    702                        || (GenericApp_NwkState == DEV_END_DEVICE) )
   \   00001E   6409         XRL     A,#0x9
   \   000020   600A         JZ      ??GenericApp_ProcessEvent_3
   \   000022   E0           MOVX    A,@DPTR
   \   000023   6407         XRL     A,#0x7
   \   000025   6005         JZ      ??GenericApp_ProcessEvent_3
   \   000027   E0           MOVX    A,@DPTR
   \   000028   6406         XRL     A,#0x6
   \   00002A   7009         JNZ     ??GenericApp_ProcessEvent_4
    703                    {
    704                      
    705                      /*
    706                      osal_start_timerEx( GenericApp_TaskID,
    707                                          GENERICAPP_SEND_MSG_EVT,
    708                                          GENERICAPP_SEND_MSG_TIMEOUT );
    709                      */
    710                      cb_GetDeviceInfo(ZB_INFO_PARENT_SHORT_ADDR, &parentShortAddr);
   \                     ??GenericApp_ProcessEvent_3:
   \   00002C                ; Setup parameters for call to function cb_GetDeviceInfo
   \   00002C   7A..         MOV     R2,#parentShortAddr & 0xff
   \   00002E   7B..         MOV     R3,#(parentShortAddr >> 8) & 0xff
   \   000030   7903         MOV     R1,#0x3
   \   000032   12....       LCALL   ??cb_GetDeviceInfo?relay
    711                    }
    712                    break;
    713          
    714                  default:
    715                    break;
    716                }
    717          
    718                // Release the memory
    719                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??GenericApp_ProcessEvent_4:
   \   000035                ; Setup parameters for call to function osal_msg_deallocate
   \   000035   EE           MOV     A,R6
   \   000036   FA           MOV     R2,A
   \   000037   EF           MOV     A,R7
   \   000038   FB           MOV     R3,A
   \   000039   12....       LCALL   ??osal_msg_deallocate?relay
    720          
    721                // Next
    722                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( GenericApp_TaskID );
   \   00003C                ; Setup parameters for call to function osal_msg_receive
   \                     ??GenericApp_ProcessEvent_1:
   \   00003C   90....       MOV     DPTR,#GenericApp_TaskID
   \   00003F   E0           MOVX    A,@DPTR
   \   000040   F9           MOV     R1,A
   \   000041   12....       LCALL   ??osal_msg_receive?relay
   \   000044   8A..         MOV     ?V0 + 2,R2
   \   000046   8B..         MOV     ?V0 + 3,R3
   \   000048   AE..         MOV     R6,?V0 + 2
   \   00004A   AF..         MOV     R7,?V0 + 3
   \   00004C   EE           MOV     A,R6
   \   00004D   4F           ORL     A,R7
   \   00004E   7003         JNZ     $+5
   \   000050   02....       LJMP    ??GenericApp_ProcessEvent_5 & 0xFFFF
   \   000053   8E82         MOV     DPL,R6
   \   000055   8F83         MOV     DPH,R7
   \   000057   E0           MOVX    A,@DPTR
   \   000058   24E6         ADD     A,#-0x1a
   \   00005A   607F         JZ      ??GenericApp_ProcessEvent_6
   \   00005C   2449         ADD     A,#0x49
   \   00005E   60B8         JZ      ??GenericApp_ProcessEvent_2
   \   000060   24FE         ADD     A,#-0x2
   \   000062   70D1         JNZ     ??GenericApp_ProcessEvent_4
   \   000064   EE           MOV     A,R6
   \   000065   240C         ADD     A,#0xc
   \   000067   F582         MOV     DPL,A
   \   000069   EF           MOV     A,R7
   \   00006A   3400         ADDC    A,#0x0
   \   00006C   F583         MOV     DPH,A
   \   00006E   E0           MOVX    A,@DPTR
   \   00006F   F5..         MOV     ?V0 + 2,A
   \   000071   A3           INC     DPTR
   \   000072   E0           MOVX    A,@DPTR
   \   000073   F5..         MOV     ?V0 + 3,A
   \   000075   78..         MOV     R0,#?V0 + 2
   \   000077   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for GenericApp_ProcessEvent>_0`:
   \   00007A   0000         DW        0
   \   00007C   0200         DW        2
   \   00007E   0680         DW        32774
   \   000080   ....         DW        ??GenericApp_ProcessEvent_7
   \   000082   2080         DW        32800
   \   000084   ....         DW        ??GenericApp_ProcessEvent_8
   \   000086   ....         DW        ??GenericApp_ProcessEvent_4
   \                     ??GenericApp_ProcessEvent_7:
   \   000088                ; Setup parameters for call to function uprint
   \   000088   7A..         MOV     R2,#`?<Constant "Match_Decs_rsp">` & 0xff
   \   00008A   7B..         MOV     R3,#(`?<Constant "Match_Decs_rsp">` >> 8) & 0xff
   \   00008C   12....       LCALL   ??uprint?relay
   \   00008F                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   00008F   EE           MOV     A,R6
   \   000090   FA           MOV     R2,A
   \   000091   EF           MOV     A,R7
   \   000092   FB           MOV     R3,A
   \   000093   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   000096   EA           MOV     A,R2
   \   000097   4B           ORL     A,R3
   \   000098   609B         JZ      ??GenericApp_ProcessEvent_4
   \   00009A   8A82         MOV     DPL,R2
   \   00009C   8B83         MOV     DPH,R3
   \   00009E   E0           MOVX    A,@DPTR
   \   00009F   701B         JNZ     ??GenericApp_ProcessEvent_9
   \   0000A1   A3           INC     DPTR
   \   0000A2   A3           INC     DPTR
   \   0000A3   A3           INC     DPTR
   \   0000A4   E0           MOVX    A,@DPTR
   \   0000A5   6015         JZ      ??GenericApp_ProcessEvent_9
   \   0000A7   90....       MOV     DPTR,#GenericApp_DstAddr + 8
   \   0000AA   7402         MOV     A,#0x2
   \   0000AC   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   0000AF   8A82         MOV     DPL,R2
   \   0000B1   8B83         MOV     DPH,R3
   \   0000B3   A3           INC     DPTR
   \   0000B4   A3           INC     DPTR
   \   0000B5   A3           INC     DPTR
   \   0000B6   A3           INC     DPTR
   \   0000B7   E0           MOVX    A,@DPTR
   \   0000B8   90....       MOV     DPTR,#GenericApp_DstAddr + 9
   \   0000BB   F0           MOVX    @DPTR,A
   \                     ??GenericApp_ProcessEvent_9:
   \   0000BC                ; Setup parameters for call to function osal_mem_free
   \   0000BC   12....       LCALL   ??osal_mem_free?relay
   \   0000BF   02....       LJMP    ??GenericApp_ProcessEvent_4 & 0xFFFF
   \                     ??GenericApp_ProcessEvent_8:
   \   0000C2   EE           MOV     A,R6
   \   0000C3   2413         ADD     A,#0x13
   \   0000C5   F582         MOV     DPL,A
   \   0000C7   EF           MOV     A,R7
   \   0000C8   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   0000CB   700A         JNZ     ??GenericApp_ProcessEvent_10
   \   0000CD                ; Setup parameters for call to function HalLedSet
   \   0000CD   7A01         MOV     R2,#0x1
   \                     ??GenericApp_ProcessEvent_11:
   \   0000CF   7902         MOV     R1,#0x2
   \   0000D1   12....       LCALL   ??HalLedSet?relay
   \   0000D4   02....       LJMP    ??GenericApp_ProcessEvent_4 & 0xFFFF
   \                     ??GenericApp_ProcessEvent_10:
   \   0000D7                ; Setup parameters for call to function HalLedSet
   \   0000D7   7A04         MOV     R2,#0x4
   \   0000D9   80F4         SJMP    ??GenericApp_ProcessEvent_11
   \                     ??GenericApp_ProcessEvent_6:
   \   0000DB                ; Setup parameters for call to function GenericApp_MessageMSGCB
   \   0000DB   EE           MOV     A,R6
   \   0000DC   FA           MOV     R2,A
   \   0000DD   EF           MOV     A,R7
   \   0000DE   FB           MOV     R3,A
   \   0000DF   12....       LCALL   ??GenericApp_MessageMSGCB?relay
   \   0000E2   02....       LJMP    ??GenericApp_ProcessEvent_4 & 0xFFFF
    723              }
    724          
    725              // return unprocessed events
    726              return (events ^ SYS_EVENT_MSG);
   \                     ??GenericApp_ProcessEvent_5:
   \   0000E5   AA..         MOV     R2,?V0 + 0
   \   0000E7   E5..         MOV     A,?V0 + 1
   \   0000E9   6480         XRL     A,#0x80
   \   0000EB   FB           MOV     R3,A
   \   0000EC   02....       LJMP    ??GenericApp_ProcessEvent_12 & 0xFFFF
    727            }
    728          
    729            // Send a message out - This event is generated by a timer
    730            //  (setup in GenericApp_Init()).
    731            
    732            if ( events & GENERICAPP_SEND_MSG_EVT )
   \                     ??GenericApp_ProcessEvent_0:
   \   0000EF   EA           MOV     A,R2
   \   0000F0   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000F2   4003         JC      $+5
   \   0000F4   02....       LJMP    ??GenericApp_ProcessEvent_13 & 0xFFFF
    733            {
    734              
    735              GenericApp_SendTheMessage();
   \   0000F7   85..82       MOV     DPL,?XSP + 0
   \   0000FA   85..83       MOV     DPH,?XSP + 1
   \   0000FD   AC82         MOV     R4,DPL
   \   0000FF   AD83         MOV     R5,DPH
   \   000101   7583..       MOV     DPH,#(`?<Constant "Hello World">` >> 8) & 0xff
   \   000104   7582..       MOV     DPL,#`?<Constant "Hello World">` & 0xff
   \   000107   740C         MOV     A,#0xc
   \   000109   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
   \   00010C                ; Setup parameters for call to function AF_DataRequest
   \   00010C   75..1E       MOV     ?V0 + 2,#0x1e
   \   00010F   78..         MOV     R0,#?V0 + 2
   \   000111   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000114   75....       MOV     ?V0 + 2,#GenericApp_TransID & 0xff
   \   000117   75....       MOV     ?V0 + 3,#(GenericApp_TransID >> 8) & 0xff
   \   00011A   78..         MOV     R0,#?V0 + 2
   \   00011C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00011F   7403         MOV     A,#0x3
   \   000121   12....       LCALL   ?XSTACK_DISP0_8
   \   000124   8582..       MOV     ?V0 + 2,DPL
   \   000127   8583..       MOV     ?V0 + 3,DPH
   \   00012A   78..         MOV     R0,#?V0 + 2
   \   00012C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00012F                ; Setup parameters for call to function osal_strlen
   \   00012F   7405         MOV     A,#0x5
   \   000131   12....       LCALL   ?XSTACK_DISP0_8
   \   000134   AA82         MOV     R2,DPL
   \   000136   AB83         MOV     R3,DPH
   \   000138   12....       LCALL   ??osal_strlen?relay
   \   00013B   EA           MOV     A,R2
   \   00013C   2401         ADD     A,#0x1
   \   00013E   F5..         MOV     ?V0 + 2,A
   \   000140   E4           CLR     A
   \   000141   3400         ADDC    A,#0x0
   \   000143   F5..         MOV     ?V0 + 3,A
   \   000145   78..         MOV     R0,#?V0 + 2
   \   000147   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00014A   75..01       MOV     ?V0 + 2,#0x1
   \   00014D   75..00       MOV     ?V0 + 3,#0x0
   \   000150   78..         MOV     R0,#?V0 + 2
   \   000152   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000155   7920         MOV     R1,#0x20
   \   000157   7C..         MOV     R4,#GenericApp_epDesc & 0xff
   \   000159   7D..         MOV     R5,#(GenericApp_epDesc >> 8) & 0xff
   \   00015B   7A..         MOV     R2,#GenericApp_DstAddr & 0xff
   \   00015D   7B..         MOV     R3,#(GenericApp_DstAddr >> 8) & 0xff
   \   00015F   12....       LCALL   ??Subroutine11_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_19:
   \   000162   12....       LCALL   ?DEALLOC_XSTACK8
    736          
    737              osal_start_timerEx( GenericApp_TaskID,
    738                                  GENERICAPP_SEND_MSG_EVT,
    739                                  GENERICAPP_SEND_MSG_TIMEOUT );
   \   000165                ; Setup parameters for call to function osal_start_timerEx
   \   000165   7C88         MOV     R4,#-0x78
   \   000167   7D13         MOV     R5,#0x13
   \   000169   7A01         MOV     R2,#0x1
   \   00016B   7B00         MOV     R3,#0x0
   \   00016D   90....       MOV     DPTR,#GenericApp_TaskID
   \   000170   E0           MOVX    A,@DPTR
   \   000171   F9           MOV     R1,A
   \   000172   12....       LCALL   ??osal_start_timerEx?relay
    740          
    741              
    742              return (events ^ GENERICAPP_SEND_MSG_EVT);
   \   000175   E5..         MOV     A,?V0 + 0
   \   000177   6401         XRL     A,#0x1
   \   000179   FA           MOV     R2,A
   \   00017A   AB..         MOV     R3,?V0 + 1
   \   00017C   8004         SJMP    ??GenericApp_ProcessEvent_12
    743            }
    744          
    745            
    746          #if defined( IAR_ARMCM3_LM )
    747            // Receive a message from the RTOS queue
    748            if ( events & GENERICAPP_RTOS_MSG_EVT )
    749            {
    750              // Process message from RTOS queue
    751              GenericApp_ProcessRtosMessage();
    752          
    753              // return unprocessed events
    754              return (events ^ GENERICAPP_RTOS_MSG_EVT);
    755            }
    756          #endif
    757          
    758            // Discard unknown events
    759            return 0;
   \                     ??GenericApp_ProcessEvent_13:
   \   00017E   7A00         MOV     R2,#0x0
   \   000180   7B00         MOV     R3,#0x0
   \                     ??GenericApp_ProcessEvent_12:
   \   000182   740C         MOV     A,#0xc
   \   000184   12....       LCALL   ?DEALLOC_XSTACK8
   \   000187   02....       LJMP    ?Subroutine0 & 0xFFFF
    760          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine12_0:
   \   000000   A3           INC     DPTR
   \   000001   E0           MOVX    A,@DPTR
   \   000002   F583         MOV     DPH,A
   \   000004   8882         MOV     DPL,R0
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   3400         ADDC    A,#0x0
   \   000002   F583         MOV     DPH,A
   \   000004   E0           MOVX    A,@DPTR
   \   000005   F8           MOV     R0,A
   \   000006   12....       LCALL   ??Subroutine12_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_21:
   \   000009   E0           MOVX    A,@DPTR
   \   00000A   22           RET
    761          
    762          /*********************************************************************
    763           * Event Generation Functions
    764           */
    765          
    766          /*********************************************************************
    767           * @fn      GenericApp_ProcessZDOMsgs()
    768           *
    769           * @brief   Process response messages
    770           *
    771           * @param   none
    772           *
    773           * @return  none
    774           */
    775          static void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
    776          {
    777            switch ( inMsg->clusterID )
    778            {
    779              case End_Device_Bind_rsp:
    780                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
    781                {
    782                  // Light LED
    783                  HalLedSet( HAL_LED_2, HAL_LED_MODE_ON );
    784                }
    785          #if defined( BLINK_LEDS )
    786                else
    787                {
    788                  // Flash LED to show failure
    789                  HalLedSet ( HAL_LED_2, HAL_LED_MODE_FLASH );
    790                }
    791          #endif
    792                break;
    793          
    794              case Match_Desc_rsp:
    795                {
    796                  uprint("Match_Decs_rsp");
    797                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
    798                  if ( pRsp )
    799                  {
    800                    if ( pRsp->status == ZSuccess && pRsp->cnt )
    801                    {
    802                      GenericApp_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
    803                      //GenericApp_DstAddr.addr.shortAddr = pRsp->nwkAddr;
    804                      GenericApp_DstAddr.addr.shortAddr = 0xFFFF;
    805                      
    806                      // Take the first endpoint, Can be changed to search through endpoints
    807                      GenericApp_DstAddr.endPoint = pRsp->epList[0];
    808          
    809                      // Light LED
    810                      //HalLedSet( HAL_LED_2, HAL_LED_MODE_ON );
    811                    }
    812                    osal_mem_free( pRsp );
    813                  }
    814                }
    815                break;
    816            }
    817          }
    818          
    819          /*********************************************************************
    820           * @fn      GenericApp_HandleKeys
    821           *
    822           * @brief   Handles all key events for this device.
    823           *
    824           * @param   shift - true if in shift/alt.
    825           * @param   keys - bit field for key events. Valid entries:
    826           *                 HAL_KEY_SW_4
    827           *                 HAL_KEY_SW_3
    828           *                 HAL_KEY_SW_2
    829           *                 HAL_KEY_SW_1
    830           *
    831           * @return  none
    832           */
    833          static void GenericApp_HandleKeys( uint8 shift, uint8 keys )
    834          {
    835            zAddrType_t dstAddr;
                               ^
Warning[Pe177]: variable "dstAddr" was declared but never referenced
    836          
    837            
    838            /*
    839            // Shift is used to make each button/switch dual purpose.
    840            if ( shift )
    841            {
    842              if ( keys & HAL_KEY_SW_1 )
    843              {
    844              }
    845              if ( keys & HAL_KEY_SW_2 )
    846              {
    847              }
    848              if ( keys & HAL_KEY_SW_3 )
    849              {
    850              }
    851              if ( keys & HAL_KEY_SW_4 )
    852              {
    853              }
    854            }
    855            else
    856            {
    857              if ( keys & HAL_KEY_SW_1 )
    858              {
    859          
    860          #if defined( SWITCH1_BIND )
    861                // we can use SW1 to simulate SW2 for devices that only have one switch,
    862                keys |= HAL_KEY_SW_2;
    863          #elif defined( SWITCH1_MATCH )
    864                // or use SW1 to simulate SW4 for devices that only have one switch
    865                keys |= HAL_KEY_SW_4;
    866          #endif
    867          
    868              }
    869          
    870              if ( keys & HAL_KEY_SW_2 )
    871              {
    872                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    873          
    874                // Initiate an End Device Bind Request for the mandatory endpoint
    875                dstAddr.addrMode = Addr16Bit;
    876                dstAddr.addr.shortAddr = 0x0000; // Coordinator
    877                ZDP_EndDeviceBindReq( &dstAddr, NLME_GetShortAddr(),
    878                                      GenericApp_epDesc.endPoint,
    879                                      GENERICAPP_PROFID,
    880                                      GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    881                                      GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    882                                      FALSE );
    883              }
    884          
    885              if ( keys & HAL_KEY_SW_3 )
    886              {
    887              }
    888          
    889              if ( keys & HAL_KEY_SW_4 )
    890              {
    891                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    892                // Initiate a Match Description Request (Service Discovery)
    893                dstAddr.addrMode = AddrBroadcast;
    894                dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
    895                ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR,
    896                                  GENERICAPP_PROFID,
    897                                  GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    898                                  GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    899                                  FALSE );
    900              }    
    901            }
    902            */
    903            
    904          }
    905          
    906          /*********************************************************************
    907           * LOCAL FUNCTIONS
    908           */
    909          
    910          /*********************************************************************
    911           * @fn      GenericApp_MessageMSGCB
    912           *
    913           * @brief   Data message processor callback.  This function processes
    914           *          any incoming data - probably from other devices.  So, based
    915           *          on cluster ID, perform the intended action.
    916           *
    917           * @param   none
    918           *
    919           * @return  none
    920           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    921          static void GenericApp_MessageMSGCB( afIncomingMSGPacket_t *pkt )
   \                     GenericApp_MessageMSGCB:
    922          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    923            unsigned char buff[12];
                                 ^
Warning[Pe177]: variable "buff" was declared but never referenced
    924            char*p;
                        ^
Warning[Pe177]: variable "p" was declared but never referenced
    925            byte nr;
                        ^
Warning[Pe177]: variable "nr" was declared but never referenced
    926            uint8 i;
                         ^
Warning[Pe177]: variable "i" was declared but never referenced
    927            uint8 ass_num;
                         ^
Warning[Pe550]: variable "ass_num" was set but never used
    928            uint8* ieeeaddr;
                          ^
Warning[Pe177]: variable "ieeeaddr" was declared but never referenced
    929            
    930            
    931            uint8 yy1;
                         ^
Warning[Pe550]: variable "yy1" was set but never used
    932            uint16 devlist[ NWK_MAX_DEVICES + 1];
                          ^
Warning[Pe177]: variable "devlist" was declared but never referenced
    933            
    934            afAddrType_t myaddr; // use for p2p
                                ^
Warning[Pe177]: variable "myaddr" was declared but never referenced
    935            
    936            ass_num = 0;
    937            
    938            switch ( pkt->clusterId )
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   A3           INC     DPTR
   \   000009   A3           INC     DPTR
   \   00000A   A3           INC     DPTR
   \   00000B   A3           INC     DPTR
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6401         XRL     A,#0x1
   \   00000F   7002         JNZ     ??GenericApp_MessageMSGCB_0
   \   000011   A3           INC     DPTR
   \   000012   E0           MOVX    A,@DPTR
   \                     ??GenericApp_MessageMSGCB_0:
   \   000013   703E         JNZ     ??GenericApp_MessageMSGCB_1
    939            {
    940              case GENERICAPP_CLUSTERID:
    941                //sprintf(buff,"%hu", pkt->cmd.DataLength);
    942               ///if( p[4] =='l' && p[5] =='e' && p[6] =='d' && p[7] =='1')
    943               // {
    944          //       uprint( (uint8*)pkt->srcAddr );
    945          //        uprint( (uint8*)pkt->endPoint);
    946                 // UART_Send_String( &pkt->LinkQuality, 1);
    947                  //uprint( pkt->cmd.Data);
    948               // }
    949               //UART_Send_String( (uint8*)&pkt->cmd.DataLength, 1);
    950               //UART_Send_String( &pkt->cmd.TransSeqNumber,1 );
    951          
    952              if( pkt->cmd.DataLength == 1)
    953              {      
    954                  yy1 = 1;
    955          #if !defined( ZDO_COORDINATOR ) 
    956                  if(pkt->cmd.Data[0] == 0x6d)
    957                  {
    958                    /// return mac address : ac xx xx ieee addr
    959                         myaddr.addrMode = (afAddrMode_t)Addr16Bit;
    960                         myaddr.endPoint = GENERICAPP_ENDPOINT;          
    961                         myaddr.addr.shortAddr = 0x0000;
    962                         
    963                      ieeeaddr = NLME_GetExtAddr();
    964                      osal_cpyExtAddr(buff+3, ieeeaddr);
    965                      buff[0] = 0xac;
    966                      buff[1] = LO_UINT16(_NIB.nwkDevAddress);
    967                      buff[2] = HI_UINT16(_NIB.nwkDevAddress);
    968                      if ( AF_DataRequest( &myaddr, &GenericApp_epDesc, GENERICAPP_CLUSTERID,  11,
    969                                    &buff[0],
    970                                    &GenericApp_TransID,
    971                                    AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) != afStatus_SUCCESS )
    972                      {
    973                           AF_DataRequest( &myaddr, &GenericApp_epDesc, GENERICAPP_CLUSTERID,  11,
    974                                    &buff[0],
    975                                    &GenericApp_TransID,
    976                                    AF_DISCV_ROUTE, AF_DEFAULT_RADIUS );
    977                        // send twice only, if it is still not ok, fuck it
    978                      }            
    979                      
    980                  }
    981                  // only routers return devlist
    982                  if( pkt->cmd.Data[0] == 0xCA )
    983                  {
    984                         myaddr.addrMode = (afAddrMode_t)Addr16Bit;
    985                         myaddr.endPoint = GENERICAPP_ENDPOINT;          
    986                         myaddr.addr.shortAddr = 0x0000;
    987                    
    988                  ass_num = AssocCount(1, 4);
    989                //  if( ass_num > 0)
    990                  //{
    991                    for(i=0;i< NWK_MAX_DEVICES; i++)
    992                    {
    993                       nr = AssociatedDevList[ i ].nodeRelation;
    994                        if(nr > 0 && nr < 5) //CHILD_RFD CHILD_RFD_RX_IDLE CHILD_FFD CHILD_FFD_RX_IDLE
    995                       //if( nr != 0XFF)
    996                       {
    997                       //  if( AssociatedDevList[ i ].shortAddr != 0x0000)
    998                       //  {
    999                            //if( AssocIsChild( AssociatedDevList[ i ].shortAddr ) != 1 || AssociatedDevList[ i ].age > NWK_ROUTE_AGE_LIMIT)
   1000                            //if( AssocIsChild( AssociatedDevList[ i ].shortAddr ) == 1 && AssociatedDevList[ i ].age > NWK_ROUTE_AGE_LIMIT )
   1001                           // {
   1002                              //  myaddr.addr.shortAddr = AssociatedDevList[ i ].shortAddr;
   1003                                /*
   1004                                if ( AF_DataRequest( &myaddr, &GenericApp_epDesc, GENERICAPP_CLUSTERID,(byte)osal_strlen( theMessageData ) + 1,
   1005                                        (byte *)&theMessageData,
   1006                                        &GenericApp_TransID,
   1007                                        AF_ACK_REQUEST, AF_DEFAULT_RADIUS ) != afStatus_SUCCESS )
   1008                                  {
   1009                                    uprint("delete asso");
   1010                                  */
   1011                             //       delete_asso( AssociatedDevList[ i ]. addrIdx);
   1012                                    
   1013                            // }
   1014                              //    else
   1015                               //   {
   1016                                    devlist[yy1] = AssociatedDevList[ i ].shortAddr;
   1017                                    yy1++;
   1018                               //   }
   1019                            
   1020                            // }
   1021                       }
   1022                        else { break; }
   1023                    }
   1024                 // }else
   1025                  //{
   1026                    //devlist[yy1] = 0;
   1027                  //}
   1028                    devlist[0] = BUILD_UINT16(0xce,  ass_num );
   1029                    if ( AF_DataRequest( &myaddr, &GenericApp_epDesc, GENERICAPP_CLUSTERID, yy1*2,
   1030                                    (byte *)&devlist,
   1031                                    &GenericApp_TransID,
   1032                                    AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) != afStatus_SUCCESS )
   1033                    {
   1034                        AF_DataRequest( &myaddr, &GenericApp_epDesc, GENERICAPP_CLUSTERID, yy1*2,
   1035                                    (byte *)&devlist,
   1036                                    &GenericApp_TransID,
   1037                                    AF_DISCV_ROUTE, AF_DEFAULT_RADIUS );
   1038                       // send twice only, if it is still not ok, fuck it
   1039                    }
   1040                  
   1041                    
   1042                    //cb_SendDataRequest( 0x0000, GENERICAPP_CLUSTERID, yy1*2+1, (uint8*)&devlist[0], 0, AF_DISCV_ROUTE, 0 );
   1043                    
   1044                    //UART_Send_String( (uint8*)&devlist[0], yy1*2);
   1045                    
   1046                      //p1 = AssocMakeList( &cnt );
   1047                      //UART_Send_String( (uint8*)p1,  AssocCount(1, 4)*2);
   1048                      //osal_mem_free(p1);
   1049                  }
   1050          #endif  
   1051              } //if( pkt->cmd.DataLength == 1)
   1052              
   1053              if( pkt->cmd.DataLength == 3)
   \   000015   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   000018   6403         XRL     A,#0x3
   \   00001A   7002         JNZ     ??GenericApp_MessageMSGCB_2
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \                     ??GenericApp_MessageMSGCB_2:
   \   00001E   7033         JNZ     ??GenericApp_MessageMSGCB_1
   1054              { 
   1055                  //ed fa 01 ,turn on led 1
   1056                  //ed ff 01  turn off led 1
   1057                  if( pkt->cmd.Data[0] == 0xed  && pkt->cmd.Data[1] == 0xfa )
   \   000020   EA           MOV     A,R2
   \   000021   2422         ADD     A,#0x22
   \   000023   F582         MOV     DPL,A
   \   000025   EB           MOV     A,R3
   \   000026   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000029   64ED         XRL     A,#0xed
   \   00002B   700E         JNZ     ??GenericApp_MessageMSGCB_3
   \   00002D   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000030   64FA         XRL     A,#0xfa
   \   000032   7007         JNZ     ??GenericApp_MessageMSGCB_3
   1058                  {
   1059                      switch(pkt->cmd.Data[2])
   \   000034   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000037   7002         JNZ     ??GenericApp_MessageMSGCB_3
   1060                      {
   1061                        case 0x01:
   1062                          led1 = 1;
   \   000039   D290         SETB    0x90.0
   1063                          break;
   1064                        case 0x05:
   1065                          // led5 = 1;
   1066                          break;
   1067                        default:break;
   1068                      }
   1069                             
   1070                  }
   1071                  if( pkt->cmd.Data[0] == 0xed  && pkt->cmd.Data[1] == 0xff )
   \                     ??GenericApp_MessageMSGCB_3:
   \   00003B   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   00003E   12....       LCALL   ??Subroutine12_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_20:
   \   000041   E0           MOVX    A,@DPTR
   \   000042   64ED         XRL     A,#0xed
   \   000044   700D         JNZ     ??GenericApp_MessageMSGCB_1
   \   000046   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   000049   F4           CPL     A
   \   00004A   7007         JNZ     ??GenericApp_MessageMSGCB_1
   1072                  {
   1073                      switch(pkt->cmd.Data[2])
   \   00004C   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   00004F   7002         JNZ     ??GenericApp_MessageMSGCB_1
   1074                      {
   1075                        case 0x01:
   1076                          led1 = 0;
   \   000051   C290         CLR     0x90.0
   1077                          break;
   1078                        case 0x05:
   1079                         //  led5 = 0;
   1080                          break;
   1081                        default:break;
   1082                      }          
   1083                  }
   1084                  
   1085              } // if( pkt->cmd.DataLength == 3)
   1086              
   1087               // led1 = !led1;
   1088               // led5 = !led5;
   1089                break;
   1090            }
   1091            
   1092          #if defined( LCD_SUPPORTED )
   1093                UART_Send_String( &pkt->cmd.Data[0], pkt->cmd.DataLength);
   \                     ??GenericApp_MessageMSGCB_1:
   \   000053                ; Setup parameters for call to function UART_Send_String
   \   000053   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   000056   FC           MOV     R4,A
   \   000057   A3           INC     DPTR
   \   000058   E0           MOVX    A,@DPTR
   \   000059   FD           MOV     R5,A
   \   00005A   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   00005D   E0           MOVX    A,@DPTR
   \   00005E   FA           MOV     R2,A
   \   00005F   A3           INC     DPTR
   \   000060   E0           MOVX    A,@DPTR
   \   000061   FB           MOV     R3,A
   \   000062   12....       LCALL   ??UART_Send_String?relay
   1094          #endif
   1095          
   1096          }
   \   000065   D083         POP     DPH
   \   000067   D082         POP     DPL
   \   000069   02....       LJMP    ?BRET
   \   00006C                REQUIRE _A_P1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   EA           MOV     A,R2
   \   000001   2422         ADD     A,#0x22
   \   000003   F582         MOV     DPL,A
   \   000005   EB           MOV     A,R3
   \   000006   3400         ADDC    A,#0x0
   \   000008   F583         MOV     DPH,A
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   EA           MOV     A,R2
   \   000001   2420         ADD     A,#0x20
   \   000003   F582         MOV     DPL,A
   \   000005   EB           MOV     A,R3
   \   000006   3400         ADDC    A,#0x0
   \   000008   F583         MOV     DPH,A
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   12....       LCALL   ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_23:
   \   000003   A3           INC     DPTR
   \   000004   E0           MOVX    A,@DPTR
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   000003                REQUIRE ??Subroutine12_0
   \   000003                ; // Fall through to label ??Subroutine12_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   12....       LCALL   ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_22:
   \   000003   A3           INC     DPTR
   \   000004   A3           INC     DPTR
   \   000005   E0           MOVX    A,@DPTR
   \   000006   6401         XRL     A,#0x1
   \   000008   22           RET

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??cb_GetDeviceInfo?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    cb_GetDeviceInfo

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??CAPI_SendCback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    CAPI_SendCback

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??cb_SendDataRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    cb_SendDataRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Serial_callBack?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Serial_callBack

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_MessageMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_MessageMSGCB

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "pong">`:
   \   000000   706F6E67     DB "pong"
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "EndDevice match">`:
   \   000000   456E6444     DB "EndDevice match"
   \            65766963
   \            65206D61
   \            74636800

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Router Device match">`:
   \   000000   526F7574     DB "Router Device match"
   \            65722044
   \            65766963
   \            65206D61
   \            74636800

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "GenericApp">`:
   \   000000   47656E65     DB "GenericApp"
   \            72696341
   \            707000  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Match_Decs_rsp">`:
   \   000000   4D617463     DB "Match_Decs_rsp"
   \            685F4465
   \            63735F72
   \            737000  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Hello World">`:
   \   000000   48656C6C     DB "Hello World"
   \            6F20576F
   \            726C6400

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_800:
   \   000000   00080000     DD 2048

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1000:
   \   000000   00100000     DD 4096

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_2000:
   \   000000   00200000     DD 8192

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_4000:
   \   000000   00400000     DD 16384

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_8000:
   \   000000   00800000     DD 32768

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_10000:
   \   000000   00000100     DD 65536

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_20000:
   \   000000   00000200     DD 131072

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_40000:
   \   000000   00000400     DD 262144

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_80000:
   \   000000   00000800     DD 524288

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_100000:
   \   000000   00001000     DD 1048576

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_200000:
   \   000000   00002000     DD 2097152

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_400000:
   \   000000   00004000     DD 4194304

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_800000:
   \   000000   00008000     DD 8388608

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1000000:
   \   000000   00000001     DD 16777216

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_2000000:
   \   000000   00000002     DD 33554432

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_4000000:
   \   000000   00000004     DD 67108864
   1097          
   1098          
   1099          static void GenericApp_SendTheMessage( void )
   1100          {
   1101            char theMessageData[] = "Hello World";
   1102          
   1103            if ( AF_DataRequest( &GenericApp_DstAddr, &GenericApp_epDesc,
   1104                                 GENERICAPP_CLUSTERID,
   1105                                 (byte)osal_strlen( theMessageData ) + 1,
   1106                                 (byte *)&theMessageData,
   1107                                 &GenericApp_TransID,
   1108                                 AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   1109            {
   1110              // Successfully requested to be sent.
   1111            }
   1112            else
   1113            {
   1114              // Error occurred in request to send.
   1115            }
   1116          }
   1117          
   1118          #if defined( IAR_ARMCM3_LM )
   1119          /*********************************************************************
   1120           * @fn      GenericApp_ProcessRtosMessage
   1121           *
   1122           * @brief   Receive message from RTOS queue, send response back.
   1123           *
   1124           * @param   none
   1125           *
   1126           * @return  none
   1127           */
   1128          static void GenericApp_ProcessRtosMessage( void )
   1129          {
   1130            osalQueue_t inMsg;
   1131          
   1132            if ( osal_queue_receive( OsalQueue, &inMsg, 0 ) == pdPASS )
   1133            {
   1134              uint8 cmndId = inMsg.cmnd;
   1135              uint32 counter = osal_build_uint32( inMsg.cbuf, 4 );
   1136          
   1137              switch ( cmndId )
   1138              {
   1139                case CMD_INCR:
   1140                  counter += 1;  /* Increment the incoming counter */
   1141                                 /* Intentionally fall through next case */
   1142          
   1143                case CMD_ECHO:
   1144                {
   1145                  userQueue_t outMsg;
   1146          
   1147                  outMsg.resp = RSP_CODE | cmndId;  /* Response ID */
   1148                  osal_buffer_uint32( outMsg.rbuf, counter );    /* Increment counter */
   1149                  osal_queue_send( UserQueue1, &outMsg, 0 );  /* Send back to UserTask */
   1150                  break;
   1151                }
   1152                
   1153                default:
   1154                  break;  /* Ignore unknown command */    
   1155              }
   1156            }
   1157          }
   1158          #endif
   1159          
   1160          /*********************************************************************
   1161           */

   Maximum stack usage in bytes:

     Function                     ISTACK PSTACK XSTACK
     --------                     ------ ------ ------
     CAPI_SendCback                   1      0     39
       -> osal_msg_allocate           0      0     24
       -> osal_msg_send               0      0     24
     GenericApp_Init                  0      0     10
       -> afRegister                  0      0     20
       -> RegisterForKeys             0      0     20
       -> HalLcdWriteString           0      0     20
       -> osal_nv_item_len            0      0     20
       -> cb_ReadConfiguration        0      0     20
       -> ZDOInitDevice               0      0     20
       -> serial_init                 0      0     20
       -> init_cc2530                 0      0     20
       -> HalLedSet                   0      0     20
     GenericApp_MessageMSGCB          2      0     24
       -> UART_Send_String            4      0      0
     GenericApp_ProcessEvent          2      0     33
       -> osal_msg_receive            0      0     48
       -> cb_GetDeviceInfo            0      0     48
       -> osal_msg_deallocate         0      0     48
       -> osal_msg_receive            0      0     48
       -> uprint                      0      0     48
       -> ZDO_ParseEPListRsp          0      0     48
       -> osal_mem_free               0      0     48
       -> HalLedSet                   0      0     48
       -> HalLedSet                   0      0     48
       -> GenericApp_MessageMSGCB     0      0     48
       -> osal_strlen                 0      0     58
       -> AF_DataRequest              0      0     66
       -> osal_start_timerEx          0      0     48
     Serial_callBack                  1      0    229
       -> HalUARTRead                 0      0    440
       -> UART_Send_String            0      0    440
       -> UART_Send_String            0      0    440
       -> UART_Send_String            0      0    440
       -> UART_Send_String            0      0    440
       -> NLME_GetExtAddr             0      0    440
       -> UART_Send_String            0      0    440
       -> set_coordi                  0      0    440
       -> set_router                  0      0    440
       -> AssocCount                  0      0    440
       -> UART_Send_String            0      0    440
       -> AF_DataRequest              0      0    458
       -> AF_DataRequest              0      0    458
       -> uprint                      0      0    440
       -> HalLedSet                   0      0    440
       -> NLME_GetShortAddr           0      0    440
       -> ZDP_EndDeviceBindReq        0      0    458
       -> uprint                      0      0    440
       -> HalLedSet                   0      0    440
       -> ZDP_MatchDescReq            0      0    456
       -> strncpy                     0      0    444
       -> strncpy                     0      0    444
       -> strtol                      0      0    444
       -> strtol                      0      0    444
       -> set_panid                   0      0    440
       -> zgWriteStartupOptions       0      0    440
       -> sysPingReqRcvd              0      0    440
       -> NLME_UpdateNV               0      0    440
       -> ZMacSetReq                  0      0    440
       -> osal_nv_item_init           0      0    444
       -> osal_nv_write               0      0    448
       -> UART_Send_String            0      0    440
       -> ser_process                 0      0    440
       -> AF_DataRequest              0      0    458
     cb_GetDeviceInfo                 0      0     38
       -> osal_memcpy                 0      0     28
       -> osal_memcpy                 0      0     28
       -> osal_memcpy                 0      0     28
       -> osal_memcpy                 0      0     28
       -> osal_memcpy                 0      0     28
       -> osal_memcpy                 0      0     28
       -> osal_memcpy                 0      0     28
       -> osal_memcpy                 0      0     28
     cb_SendDataRequest               0      0     41
       -> NLME_IsAddressBroadcast     0      0     54
       -> AF_DataRequest              0      0     72
       -> CAPI_SendCback              0      0     54


   Segment part sizes:

     Function/Label                    Bytes
     --------------                    -----
     _A_P1                                1
     _A_IEN0                              1
     WDCTL                                1
     GenericApp_ClusterList               2
     GenericApp_SimpleDesc               12
     GenericApp_epDesc                    6
     GenericApp_TaskID                    1
     GenericApp_NwkState                  1
     GenericApp_TransID                   1
     GenericApp_DstAddr                  12
     parentShortAddr                      2
     cb_GetDeviceInfo                   138
     CAPI_SendCback                      54
     ?Subroutine0                         5
     cb_SendDataRequest                 201
     ?Subroutine7                         4
     ??Subroutine11_0                     6
     Serial_callBack                   1556
     ?Subroutine2                        10
     GenericApp_Init                    154
     ?Subroutine1                        10
     GenericApp_ProcessEvent            394
     ??Subroutine12_0                     7
     ?Subroutine4                        11
     GenericApp_MessageMSGCB            108
     ?Subroutine8                         4
     ?Subroutine10                       11
     ?Subroutine6                        12
     ?Subroutine5                         6
     ?Subroutine9                         3
     ?Subroutine3                         9
     ??cb_GetDeviceInfo?relay             6
     ??CAPI_SendCback?relay               6
     ??cb_SendDataRequest?relay           6
     ??Serial_callBack?relay              6
     ??GenericApp_Init?relay              6
     ??GenericApp_ProcessEvent?relay      6
     ??GenericApp_MessageMSGCB?relay      6
     ?<Constant "pong">                   5
     ?<Constant "EndDevice match">       16
     ?<Constant "Router Device match">   20
     ?<Constant "GenericApp">            11
     ?<Constant "Match_Decs_rsp">        15
     ?<Constant "Hello World">           12
     __Constant_800                       4
     __Constant_1000                      4
     __Constant_2000                      4
     __Constant_4000                      4
     __Constant_8000                      4
     __Constant_10000                     4
     __Constant_20000                     4
     __Constant_40000                     4
     __Constant_80000                     4
     __Constant_100000                    4
     __Constant_200000                    4
     __Constant_400000                    4
     __Constant_800000                    4
     __Constant_1000000                   4
     __Constant_2000000                   4
     __Constant_4000000                   4

 
 2 703 bytes in segment BANKED_CODE
    42 bytes in segment BANK_RELAYS
     3 bytes in segment SFR_AN
   157 bytes in segment XDATA_ROM_C
    23 bytes in segment XDATA_Z
 
 2 745 bytes of CODE  memory
    93 bytes of CONST memory (+ 64 bytes shared)
     0 bytes of DATA  memory (+  3 bytes shared)
    23 bytes of XDATA memory

Errors: none
Warnings: 21
